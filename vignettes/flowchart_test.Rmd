---
title: "Flowchart"
author: "Kris Esturas"
date: "2026-02-10"
output:
  html_document:
    self_contained: true
---

```{hello}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{install once if needed:}
# install.packages("DiagrammeR")

library(DiagrammeR)

mermaid("
flowchart TD
  A([START Stage 3: Simulated Whittling]) --> B[Initialise<br/>iteration = 0<br/>keystone_set = {}<br/>feature_amounts = calculate_feature_conservation()]
  B --> C{{iteration < max_iterations?}}
  C -- No --> Z([STOP: max iterations reached])
  C -- Yes --> D[iteration++<br/>sync unit_dict -> minpatch_data]
  D --> E[edge_units = find_edge_units()]
  E --> F[edge_units = edge_units \\\\ keystone_set]
  F --> G{{edge_units empty?}}
  G -- Yes --> Y([STOP: no edge units left])
  G -- No --> H[whittle_scores_raw = calculate_whittle_scores(edge_units, feature_amounts)]
  H --> I[Split scores:<br/>If score == 'needed for targets' -> add to keystone_set<br/>Else keep numeric score]
  I --> J{{Any numeric (scoreable) units?}}
  J -- No --> X([STOP: all candidates keystone])
  J -- Yes --> K[candidate = unit with minimum whittling score]
  K --> L{{can_remove_unit(candidate)?}}
  L -- No --> M[Add candidate to keystone_set]
  M --> C
  L -- Yes --> N[Remove candidate:<br/>unit_dict[candidate].status = 0<br/>sync to minpatch_data]
  N --> O[Update cached feature_amounts:<br/>feature_amounts[f] -= abundance(candidate,f)]
  O --> C
")
```

## Including Plots

You can also embed plots, for example:

```{}
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
