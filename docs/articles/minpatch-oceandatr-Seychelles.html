<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using oceandatr and minpatch to reduce fragmentation in a marine planning region (Seychelles) • minpatch</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using oceandatr and minpatch to reduce fragmentation in a marine planning region (Seychelles)">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">minpatch</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/minpatch.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/boundary-penalty.html">Boundary penalty in MinPatch</a></li>
    <li><a class="dropdown-item" href="../articles/minpatch-oceandatr-Seychelles.html">Using oceandatr and minpatch to reduce fragmentation in a marine planning region (Seychelles)</a></li>
    <li><a class="dropdown-item" href="../articles/minpatchTasmania.html">MinPatch in Tasmania</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/SpatialPlanning/minpatch/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="minpatch-oceandatr-Seychelles_files/kePrint-0.0.1/kePrint.js"></script><link href="minpatch-oceandatr-Seychelles_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Using oceandatr and minpatch to reduce fragmentation in a marine planning region (Seychelles)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/SpatialPlanning/minpatch/blob/HEAD/vignettes/minpatch-oceandatr-Seychelles.Rmd" class="external-link"><code>vignettes/minpatch-oceandatr-Seychelles.Rmd</code></a></small>
      <div class="d-none name"><code>minpatch-oceandatr-Seychelles.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">1. Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In many marine spatial planning problems, the goal is not only to
meet representation targets at the lowest possible cost, but also to
consider <em>how selected areas are arranged in space</em>. Highly
fragmented marine protected areas can be difficult to manage and
enforce, and small isolated patches may not sustain viable populations.
Scattered solutions can also be difficult to justify to decision-makers
and stakeholders.</p>
<p>Two R packages are especially helpful for tackling these issues in a
marine context.</p>
<ul>
<li><p>The <code>oceandatr</code> package offers a practical way to
build realistic, analysis-ready marine planning datasets. It helps users
obtain planning boundaries (e.g., exclusive economic zones or high-seas
regions), generate planning-unit grids, and access global ocean
datasets—including bathymetry, geomorphology, seamounts, and
environmental conditions—aligned to those grids. Together, these tools
make it easier to assemble consistent inputs for marine spatial planning
analyses.</p></li>
<li><p>The <code>minpatch</code> package is a post-processing tool that
modifies conservation planning solutions produced by
<code>prioritizr</code> to reduce fragmentation. It enforces a
user-defined minimum patch size by removing patches that are too small
and adding new areas to maintain conservation targets. It then
simplifies the solution by removing unnecessary planning units, while
tracking how these changes affect patch structure and total
cost.</p></li>
</ul>
<p>In this vignette, we demonstrate the use of <code>oceandatr</code>
and <code>minpatch</code> using a simple marine example from the
Seychelles Exclusive Economic Zone. We first use <code>oceandatr</code>
to construct a gridded planning problem with a set of marine features
and then solve a standard <code>prioritizr</code> minimum-set problem.
We then apply <code>minpatch</code> to explore how different minimum
patch sizes and boundary penalties influence the resulting
solutions.</p>
</div>
<div class="section level2">
<h2 id="study-region-and-planning-units-with-oceandatr">2. Study region and planning units with oceandatr<a class="anchor" aria-label="anchor" href="#study-region-and-planning-units-with-oceandatr"></a>
</h2>
<div class="section level3">
<h3 id="load-packages">2.1 Load packages<a class="anchor" aria-label="anchor" href="#load-packages"></a>
</h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emlab-ucsb.github.io/oceandatr/" class="external-link">oceandatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net" class="external-link">prioritizr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/SpatialPlanning/minpatch" class="external-link">minpatch</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tibble.tidyverse.org/" class="external-link">tibble</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="co"># Note: oceandatr requires an up-to-date version of curl for data downloads</span></span>
<span><span class="co"># install.packages("curl") </span></span>
<span><span class="co"># packageVersion("curl")</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="seychelles-eez-as-the-planning-region">2.2 Seychelles EEZ as the planning region<a class="anchor" aria-label="anchor" href="#seychelles-eez-as-the-planning-region"></a>
</h3>
<p>We start by using <code><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_boundary.html" class="external-link">get_boundary()</a></code> from
<code>oceandatr</code> to obtain the Seychelles Exclusive Economic zone
(EEZ). This defines our marine planning domain.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">Seychelles_eez</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_boundary.html" class="external-link">get_boundary</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Seychelles"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot to check we have Seychelles' EEZ</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Seychelles_eez</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>     col <span class="op">=</span> <span class="st">"lightgreen"</span>, </span>
<span>     main <span class="op">=</span> <span class="st">"Seychelles EEZ"</span>, </span>
<span>     axes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/planning-domain-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="choose-an-equal-area-projection">2.3 Choose an equal-area projection<a class="anchor" aria-label="anchor" href="#choose-an-equal-area-projection"></a>
</h3>
<p>We reproject the planning region into an equal-area projection to
ensure that area- and distance-based calculations are meaningful.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># use sf::st_bbox to get the bounding box coordinates (in lon/lat)</span></span>
<span><span class="co">#sf::st_bbox(Seychelles_eez)</span></span>
<span></span>
<span><span class="co"># use projectionwizard.org to choose an equal-area projection, then store as a PROJ string</span></span>
<span><span class="co"># https://projectionwizard.org </span></span>
<span></span>
<span><span class="va">projection_Seychelles</span> <span class="op">&lt;-</span> <span class="st">"+proj=laea +lon_0=55 +lat_0=-4.5 +datum=WGS84 +units=m +no_defs"</span></span>
<span></span>
<span><span class="co"># check CRS if needed</span></span>
<span><span class="co"># sf::st_crs(projection_Seychelles) </span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-a-planning-unit-grid">2.4 Create a planning-unit grid<a class="anchor" aria-label="anchor" href="#create-a-planning-unit-grid"></a>
</h3>
<p>We now create a grid over the EEZ. To keep runtime moderate, we use a
fairly coarse resolution. Our units will be in meters.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check which units to use</span></span>
<span><span class="co"># sf::st_crs(projection_Seychelles, </span></span>
<span><span class="co">#           parameters = TRUE)$units_gdal</span></span>
<span></span>
<span><span class="co"># grid the planning area</span></span>
<span><span class="va">Seychelles_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_grid.html" class="external-link">get_grid</a></span><span class="op">(</span></span>
<span>  boundary   <span class="op">=</span> <span class="va">Seychelles_eez</span>,</span>
<span>  resolution <span class="op">=</span> <span class="fl">30000</span>, <span class="co"># 30,000 just to test the code but a finer resolution can be opted with a more powerful PC    </span></span>
<span>  crs        <span class="op">=</span> <span class="va">projection_Seychelles</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># project the eez into same projection as grid for plotting</span></span>
<span><span class="va">Seychelles_eez_proj</span> <span class="op">&lt;-</span> <span class="va">Seychelles_eez</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="va">projection_Seychelles</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot the grid</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Seychelles_grid</span>, </span>
<span>            col <span class="op">=</span> <span class="st">"gold3"</span>, </span>
<span>            axes <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            legend <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            main <span class="op">=</span> <span class="st">"Seychelles spatial grid (30 km)"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">Seychelles_eez_proj</span>, </span>
<span>     add <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     border <span class="op">=</span> <span class="st">"black"</span>, </span>
<span>     lwd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/grid-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<p>Each <em>cell</em> of <code>Seychelles_grid</code> is a planning
unit. To build a <code>prioritizr</code> problem later, it’s useful to
have a vector version of the grid:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># convert grid to sf polygons as minpatch only works with sf</span></span>
<span><span class="va">Seychelles_pu</span> <span class="op">&lt;-</span> <span class="va">Seychelles_grid</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    id   <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    cost <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1e6</span>  <span class="co"># cost = area in km²</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">layer</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="building-marine-features-with-oceandatr">3. Building marine features with oceandatr<a class="anchor" aria-label="anchor" href="#building-marine-features-with-oceandatr"></a>
</h2>
<p>We will use a set of features available on
<code>oceandatr</code>:</p>
<ul>
<li><p>bathymetric depth zones</p></li>
<li><p>geomorphology - seafloor features (banks, ridges, etc.)</p></li>
<li><p>knolls</p></li>
<li><p>seamounts</p></li>
<li><p>coral habitat</p></li>
<li><p>environmental zones - clusters of environmental
conditions</p></li>
</ul>
<div class="section level3">
<h3 id="prepare-feature-stack">3.1 Prepare feature stack<a class="anchor" aria-label="anchor" href="#prepare-feature-stack"></a>
</h3>
<p>These layers can easily be obtained using the
<code>get_features</code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed for reproducibility in the get_enviro_zones() sampling to find optimal cluster number</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">500</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emlab-ucsb.github.io/oceandatr/reference/get_features.html" class="external-link">get_features</a></span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">Seychelles_grid</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://emlab-ucsb.github.io/oceandatr/reference/remove_empty_layers.html" class="external-link">remove_empty_layers</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># tidy up feature data names for nicer mapping</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="plot-features">3.2 Plot features<a class="anchor" aria-label="anchor" href="#plot-features"></a>
</h3>
<p>Features are visualised with <strong>tmap</strong>. Planning units
are coloured <strong>blue</strong> where a feature is present and
<strong>grey</strong> where it is absent.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-tmap/tmap" class="external-link">tmap</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"_"</span>, <span class="st">" "</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">feature_bin</span> <span class="op">&lt;-</span> <span class="va">feature_set</span> <span class="op">&gt;</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">feature_bin</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_raster.html" class="external-link">tm_raster</a></span><span class="op">(</span></span>
<span>    col.scale <span class="op">=</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_scale_categorical.html" class="external-link">tm_scale_categorical</a></span><span class="op">(</span></span>
<span>      values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"royalblue"</span><span class="op">)</span>,</span>
<span>      labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Absent"</span>, <span class="st">"Present"</span><span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    col.legend <span class="op">=</span> <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_legend.html" class="external-link">tm_legend_hide</a></span><span class="op">(</span><span class="op">)</span>,   <span class="co"># hide legend for this layer</span></span>
<span>    col.free <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_facets.html" class="external-link">tm_facets</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_shape.html" class="external-link">tm_shape</a></span><span class="op">(</span><span class="va">Seychelles_eez</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_polygons.html" class="external-link">tm_borders</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span></span>
<span>    panel.label.size <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>    legend.show <span class="op">=</span> <span class="cn">FALSE</span> <span class="op">)</span></span>
<span></span>
<span><span class="va">m</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_add_legend.html" class="external-link">tm_add_legend</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"fill"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Absent"</span>, <span class="st">"Present"</span><span class="op">)</span>,</span>
<span>    col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"royalblue"</span><span class="op">)</span>,</span>
<span>    title <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://r-tmap.github.io/tmap/reference/tm_layout.html" class="external-link">tm_layout</a></span><span class="op">(</span></span>
<span>    legend.outside <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    legend.position <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"center"</span>, <span class="st">"bottom"</span><span class="op">)</span>,</span>
<span>    legend.text.size <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/visualise-features-1.png" class="r-plt" alt="" width="1440" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="converting-features-to-sf-object-and-combining-it-with-the-pu-grid">3.3 Converting features to sf object and combining it with the PU
grid<a class="anchor" aria-label="anchor" href="#converting-features-to-sf-object-and-combining-it-with-the-pu-grid"></a>
</h3>
<p>As MinPatch only works well with sf objects, we convert this feature
stack into sf. Afterwards, we put features and the grid as one data
table.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># features to sf</span></span>
<span><span class="va">features</span> <span class="op">&lt;-</span> <span class="va">feature_set</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">stars</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/stars/reference/st_as_stars.html" class="external-link">st_as_stars</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># convert data to sf</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>id <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combining </span></span>
<span><span class="va">Seychelles_sf</span> <span class="op">&lt;-</span> <span class="va">Seychelles_pu</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">features</span><span class="op">)</span>,</span>
<span>    by <span class="op">=</span> <span class="st">"id"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># store feature column names</span></span>
<span><span class="va">feature_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">features</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">setdiff</a></span><span class="op">(</span><span class="st">"id"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="build-and-solve-a-prioritizr-problem">4. Build and solve a <code>prioritizr</code> problem<a class="anchor" aria-label="anchor" href="#build-and-solve-a-prioritizr-problem"></a>
</h2>
<p>We now build a simple minimum-set problem using
<code>prioritizr</code>, with equal-weight features and a uniform target
of 30% for each feature.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build the problem using sf planning units + feature columns</span></span>
<span><span class="va">p_base</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu"><a href="https://prioritizr.net/reference/problem.html" class="external-link">problem</a></span><span class="op">(</span></span>
<span>    x              <span class="op">=</span> <span class="va">Seychelles_sf</span>,</span>
<span>    features       <span class="op">=</span> <span class="va">feature_set</span>,</span>
<span>    cost_column    <span class="op">=</span> <span class="st">"cost"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_min_set_objective.html" class="external-link">add_min_set_objective</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_relative_targets.html" class="external-link">add_relative_targets</a></span><span class="op">(</span><span class="fl">0.30</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># 30% of each feature</span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_binary_decisions.html" class="external-link">add_binary_decisions</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://prioritizr.net/reference/add_rsymphony_solver.html" class="external-link">add_rsymphony_solver</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># change this to cbc later</span></span>
<span><span class="va">p_base</span></span></code></pre></div>
<pre><code><span><span class="co">#&gt; A conservation problem (<span style="color: #0000BB;">&lt;ConservationProblem&gt;</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">├•data</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│├•</span>features:    <span style="color: #0000BB;">"Continental shelf"</span>, <span style="color: #0000BB;">"Upper bathyal"</span>, <span style="color: #0000BB;">"Lower bathyal"</span>, <span style="color: #0000BB;">"Abyssal"</span>, … (28 total)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│└•</span>planning units:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">├•</span>data:       <span style="color: #0000BB;">&lt;sf&gt;</span> (1500 total)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">├•</span>costs:      continuous values (between <span style="color: #0000BB;">900.2126</span> and <span style="color: #0000BB;">900.2126</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">├•</span>extent:     <span style="color: #0000BB;">-1301436</span>, <span style="color: #0000BB;">-912664.9</span>, <span style="color: #0000BB;">511794.5</span>, <span style="color: #0000BB;">457589</span> (xmin, ymin, xmax, ymax)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│</span> <span style="color: #00BBBB;">└•</span>CRS:        +proj=laea +lat_0=-4.5 +lon_0=55 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs (projected)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">├•formulation</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│├•</span>objective:   minimum set objective</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│├•</span>penalties:   <span style="color: #B2B2B2;">none specified</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│├•</span>features:</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">││├•</span>targets:    relative targets (all equal to <span style="color: #0000BB;">0.3</span>)</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">││└•</span>weights:    <span style="color: #B2B2B2;">none specified</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│├•</span>constraints: <span style="color: #B2B2B2;">none specified</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">│└•</span>decisions:   binary decision</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">└•optimization</span></span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">├•</span>portfolio:   default portfolio</span></span>
<span><span class="co">#&gt;  <span style="color: #00BBBB;">└•</span>solver:      rsymphony solver (`gap` = <span style="color: #0000BB;">0.1</span>, `time_limit` = <span style="color: #0000BB;">2147483647</span>, `first_feasible` = <span style="color: #0000BB;">FALSE</span>, …)</span></span>
<span><span class="co">#&gt; <span style="color: #555555;"># ℹ Use `summary(...)` to see complete formulation.</span></span></span></code></pre>
<p>We then solve this baseline problem without any fragmentation
controls and use it as a reference for the MinPatch experiments.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># solve the baseline problem</span></span>
<span><span class="va">t_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">s_base</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">p_base</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the baseline solution</span></span>
<span><span class="va">p_base_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_prioritizr.html">plot_prioritizr</a></span><span class="op">(</span><span class="va">s_base</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Baseline (no MinPatch)"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">p_base_plot</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/solve-baseline-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<p>In this baseline solution, we see that the selected planning units
are fragmented and scattered across the planning region.</p>
</div>
<div class="section level2">
<h2 id="set-up-minpatch-parameters">5. Set up MinPatch parameters<a class="anchor" aria-label="anchor" href="#set-up-minpatch-parameters"></a>
</h2>
<p>We define minimum patch sizes relative to the planning units by
scaling the <strong>median PU area</strong> by <code>multipliers</code>
(5×, 10×, 20×). This makes the thresholds easy to interpret as “roughly
how many planning units per patch”. We also set a single
<strong><code>patch_radius</code></strong> for all runs, chosen to
represent a neighbourhood of about 10 planning units. This radius
defines the spatial search distance used by MinPatch to identify
neighbouring planning units when forming, expanding, or merging
patches.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># median planning-unit area (m² and km²)</span></span>
<span><span class="va">median_pu_area_m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">Seychelles_sf</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">median_pu_area_km2</span> <span class="op">&lt;-</span> <span class="va">median_pu_area_m2</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span></span>
<span><span class="co"># multipliers relative to the median PU area</span></span>
<span><span class="va">multipliers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># minimum patch sizes in m² and km²</span></span>
<span><span class="va">patch_sizes_m2</span>  <span class="op">&lt;-</span> <span class="va">multipliers</span> <span class="op">*</span> <span class="va">median_pu_area_m2</span></span>
<span><span class="va">patch_sizes_km2</span> <span class="op">&lt;-</span> <span class="va">patch_sizes_m2</span> <span class="op">/</span> <span class="fl">1e6</span></span>
<span></span>
<span><span class="co"># setting patch radius as the length of 10 PUs</span></span>
<span><span class="va">median_pu_length_m</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">median_pu_area_m2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># set radius to 10 PU lengths</span></span>
<span><span class="va">patch_radius</span> <span class="op">&lt;-</span> <span class="fl">10</span> <span class="op">*</span> <span class="va">median_pu_length_m</span></span>
<span></span>
<span><span class="co"># summary table</span></span>
<span><span class="va">minpatch_param_summary</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  multiplier       <span class="op">=</span> <span class="va">multipliers</span>,</span>
<span>  min_patch_m2     <span class="op">=</span> <span class="va">patch_sizes_m2</span>,</span>
<span>  min_patch_km2    <span class="op">=</span> <span class="va">patch_sizes_km2</span>,</span>
<span>  median_pu_m2     <span class="op">=</span> <span class="va">median_pu_area_m2</span>,</span>
<span>  median_pu_area_km2 <span class="op">=</span> <span class="va">median_pu_area_km2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># summaries of the different values</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\nMinPatch parameters (relative to planning units):\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; MinPatch parameters (relative to planning units):</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"- Median planning unit area:"</span>,</span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">median_pu_area_km2</span>, <span class="fl">3</span><span class="op">)</span>, <span class="st">"km^2\n\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; - Median planning unit area: 900.213 km^2</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">multipliers</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Multiplier:"</span>, <span class="va">multipliers</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"x median PU area\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - Minimum patch size:"</span>,</span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">patch_sizes_km2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"km^2\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - Corresponds to ≈"</span>,</span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">patch_sizes_km2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">/</span> <span class="va">median_pu_area_km2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>      <span class="st">"planning units\n\n"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; Multiplier: 5 x median PU area</span></span>
<span><span class="co">#&gt;   - Minimum patch size: 4501.06 km^2</span></span>
<span><span class="co">#&gt;   - Corresponds to ≈ 5 planning units</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiplier: 10 x median PU area</span></span>
<span><span class="co">#&gt;   - Minimum patch size: 9002.13 km^2</span></span>
<span><span class="co">#&gt;   - Corresponds to ≈ 10 planning units</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Multiplier: 20 x median PU area</span></span>
<span><span class="co">#&gt;   - Minimum patch size: 18004.25 km^2</span></span>
<span><span class="co">#&gt;   - Corresponds to ≈ 20 planning units</span></span>
<span></span>
<span><span class="va">median_pu_length</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">median_pu_area_m2</span><span class="op">)</span>      <span class="co"># ~ PU width (m)</span></span>
<span><span class="va">radius_in_pus</span> <span class="op">&lt;-</span> <span class="va">patch_radius</span> <span class="op">/</span> <span class="va">median_pu_length</span> <span class="co"># PU-widths</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Patch radius used for all runs:\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Patch radius used for all runs:</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  -"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">patch_radius</span>, <span class="fl">0</span><span class="op">)</span>, <span class="st">"m (≈"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">patch_radius</span><span class="op">/</span><span class="fl">1000</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"km)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - 300035 m (≈ 300.04 km)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"  - ≈"</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">radius_in_pus</span>, <span class="fl">1</span><span class="op">)</span>, <span class="st">"planning units outward (radius)\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   - ≈ 10 planning units outward (radius)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="run-minpatch-for-different-minimum-patch-sizes">6. Run MinPatch for different minimum patch sizes<a class="anchor" aria-label="anchor" href="#run-minpatch-for-different-minimum-patch-sizes"></a>
</h2>
<p>We now run MinPatch once for each minimum patch factor using the
different multipliers. Each run starts from the same
<code>prioritizr</code> solution but applies different constraints on
minimum patch size.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">minpatch_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">patch_sizes_m2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">minpatch_times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">patch_sizes_m2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">patch_sizes_m2</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n============================================\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Running MinPatch with min patch area ~"</span>,</span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="va">patch_sizes_km2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>, <span class="st">"km^2 ("</span>,</span>
<span>    <span class="va">multipliers</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>, <span class="st">"x median PU)\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"============================================\n"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># time the MinPatch run</span></span>
<span>  <span class="va">t_mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>     <span class="va">minpatch_results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_minpatch.html">run_minpatch</a></span><span class="op">(</span></span>
<span>    prioritizr_problem   <span class="op">=</span> <span class="va">p_base</span>,</span>
<span>    prioritizr_solution  <span class="op">=</span> <span class="va">s_base</span>,</span>
<span>    min_patch_size       <span class="op">=</span> <span class="va">patch_sizes_m2</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>    patch_radius         <span class="op">=</span> <span class="va">patch_radius</span>,</span>
<span>    boundary_penalty     <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    remove_small_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    add_patches          <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    whittle_patches      <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    verbose              <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="co"># store elapsed time (seconds)</span></span>
<span>  <span class="va">minpatch_times</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t_mp</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ============================================</span></span>
<span><span class="co">#&gt; Running MinPatch with min patch area ~ 4501.06 km^2 ( 5 x median PU)</span></span>
<span><span class="co">#&gt; ============================================</span></span>
<span><span class="co">#&gt; Validating inputs...</span></span>
<span><span class="co">#&gt; Initializing data structures...</span></span>
<span><span class="co">#&gt; Calculating boundary matrix using 14 cores...</span></span>
<span><span class="co">#&gt; Processing chunks in parallel...</span></span>
<span><span class="co">#&gt; Combining results...</span></span>
<span><span class="co">#&gt; Creating patch radius dictionary (optimized)...</span></span>
<span><span class="co">#&gt; Processed 100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 600 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 700 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 800 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 900 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1000 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Calculating initial patch statistics...</span></span>
<span><span class="co">#&gt; Stage 1: Removing small patches...</span></span>
<span><span class="co">#&gt; Stage 2: Adding new patches...</span></span>
<span><span class="co">#&gt;   Initial unmet targets: 22 </span></span>
<span><span class="co">#&gt;   Unmet feature IDs: 1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 16, 19, 20, 22, 23, 24, 25, 26, 27, 28 </span></span>
<span><span class="co">#&gt;   Iteration 1 - Unmet targets: 22 </span></span>
<span><span class="co">#&gt;     Found 1268 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0001156402 for unit 1035 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1035 </span></span>
<span><span class="co">#&gt;   Iteration 2 - Unmet targets: 18 </span></span>
<span><span class="co">#&gt;     Found 1188 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00009560689 for unit 1467 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1467 </span></span>
<span><span class="co">#&gt;   Iteration 3 - Unmet targets: 8 </span></span>
<span><span class="co">#&gt;     Found 1043 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00005491464 for unit 2 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 2 </span></span>
<span><span class="co">#&gt;   Iteration 4 - Unmet targets: 2 </span></span>
<span><span class="co">#&gt;     Found 910 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00001454845 for unit 192 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 192 </span></span>
<span><span class="co">#&gt;   All conservation targets are now met!</span></span>
<span><span class="co">#&gt; Stage 3: Removing unnecessary planning units...</span></span>
<span><span class="co">#&gt;     Edge units found: 178 </span></span>
<span><span class="co">#&gt;     Keystone units: 0 </span></span>
<span><span class="co">#&gt;     New keystone units: 12 </span></span>
<span><span class="co">#&gt;     Scoreable units: 166 </span></span>
<span><span class="co">#&gt;     Removed unit 418 at iteration 1 </span></span>
<span><span class="co">#&gt;     Edge units found: 167 </span></span>
<span><span class="co">#&gt;     Keystone units: 12 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 167 </span></span>
<span><span class="co">#&gt;     Removed unit 383 at iteration 2 </span></span>
<span><span class="co">#&gt;     Edge units found: 169 </span></span>
<span><span class="co">#&gt;     Keystone units: 12 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 169 </span></span>
<span><span class="co">#&gt;     Removed unit 419 at iteration 3 </span></span>
<span><span class="co">#&gt;     Edge units found: 169 </span></span>
<span><span class="co">#&gt;     Keystone units: 12 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 169 </span></span>
<span><span class="co">#&gt;     Removed unit 420 at iteration 4 </span></span>
<span><span class="co">#&gt;     Edge units found: 170 </span></span>
<span><span class="co">#&gt;     Keystone units: 12 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 170 </span></span>
<span><span class="co">#&gt;     Removed unit 385 at iteration 5 </span></span>
<span><span class="co">#&gt;     Removed unit 350 at iteration 6 </span></span>
<span><span class="co">#&gt;     Unit 349 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Removed unit 351 at iteration 8 </span></span>
<span><span class="co">#&gt;     Removed unit 317 at iteration 9 </span></span>
<span><span class="co">#&gt;     Removed unit 283 at iteration 10 </span></span>
<span><span class="co">#&gt;   Whittling iteration 100 </span></span>
<span><span class="co">#&gt;   Whittling iteration 200 </span></span>
<span><span class="co">#&gt;   Whittling iteration 300 </span></span>
<span><span class="co">#&gt;   No units can be removed - all are keystone - terminating</span></span>
<span><span class="co">#&gt; Calculating final statistics...</span></span>
<span><span class="co">#&gt; MinPatch processing complete!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ============================================</span></span>
<span><span class="co">#&gt; Running MinPatch with min patch area ~ 9002.13 km^2 ( 10 x median PU)</span></span>
<span><span class="co">#&gt; ============================================</span></span>
<span><span class="co">#&gt; Validating inputs...</span></span>
<span><span class="co">#&gt; Initializing data structures...</span></span>
<span><span class="co">#&gt; Calculating boundary matrix using 14 cores...</span></span>
<span><span class="co">#&gt; Processing chunks in parallel...</span></span>
<span><span class="co">#&gt; Combining results...</span></span>
<span><span class="co">#&gt; Creating patch radius dictionary (optimized)...</span></span>
<span><span class="co">#&gt; Processed 100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 600 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 700 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 800 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 900 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1000 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Calculating initial patch statistics...</span></span>
<span><span class="co">#&gt; Stage 1: Removing small patches...</span></span>
<span><span class="co">#&gt; Stage 2: Adding new patches...</span></span>
<span><span class="co">#&gt;   Initial unmet targets: 24 </span></span>
<span><span class="co">#&gt;   Unmet feature IDs: 1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 13, 14, 15, 16, 18, 19, 20, 22, 23, 24, 25, 26, 27, 28 </span></span>
<span><span class="co">#&gt;   Iteration 1 - Unmet targets: 24 </span></span>
<span><span class="co">#&gt;     Found 1369 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00009068137 for unit 1456 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1456 </span></span>
<span><span class="co">#&gt;   Iteration 2 - Unmet targets: 16 </span></span>
<span><span class="co">#&gt;     Found 1188 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00008346697 for unit 1035 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1035 </span></span>
<span><span class="co">#&gt;   Iteration 3 - Unmet targets: 8 </span></span>
<span><span class="co">#&gt;     Found 1102 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00005543891 for unit 916 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 916 </span></span>
<span><span class="co">#&gt;   Iteration 4 - Unmet targets: 6 </span></span>
<span><span class="co">#&gt;     Found 1025 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00004289114 for unit 1 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1 </span></span>
<span><span class="co">#&gt;   Iteration 5 - Unmet targets: 1 </span></span>
<span><span class="co">#&gt;     Found 480 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0000104797 for unit 484 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 484 </span></span>
<span><span class="co">#&gt;   All conservation targets are now met!</span></span>
<span><span class="co">#&gt; Stage 3: Removing unnecessary planning units...</span></span>
<span><span class="co">#&gt;     Edge units found: 151 </span></span>
<span><span class="co">#&gt;     Keystone units: 0 </span></span>
<span><span class="co">#&gt;     New keystone units: 1 </span></span>
<span><span class="co">#&gt;     Scoreable units: 150 </span></span>
<span><span class="co">#&gt;     Removed unit 172 at iteration 1 </span></span>
<span><span class="co">#&gt;     Edge units found: 151 </span></span>
<span><span class="co">#&gt;     Keystone units: 1 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 151 </span></span>
<span><span class="co">#&gt;     Removed unit 143 at iteration 2 </span></span>
<span><span class="co">#&gt;     Edge units found: 153 </span></span>
<span><span class="co">#&gt;     Keystone units: 1 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 153 </span></span>
<span><span class="co">#&gt;     Removed unit 142 at iteration 3 </span></span>
<span><span class="co">#&gt;     Edge units found: 154 </span></span>
<span><span class="co">#&gt;     Keystone units: 1 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 154 </span></span>
<span><span class="co">#&gt;     Removed unit 115 at iteration 4 </span></span>
<span><span class="co">#&gt;     Edge units found: 155 </span></span>
<span><span class="co">#&gt;     Keystone units: 1 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 155 </span></span>
<span><span class="co">#&gt;     Removed unit 114 at iteration 5 </span></span>
<span><span class="co">#&gt;     Removed unit 171 at iteration 6 </span></span>
<span><span class="co">#&gt;     Removed unit 173 at iteration 7 </span></span>
<span><span class="co">#&gt;     Removed unit 181 at iteration 8 </span></span>
<span><span class="co">#&gt;     Removed unit 182 at iteration 9 </span></span>
<span><span class="co">#&gt;     Removed unit 183 at iteration 10 </span></span>
<span><span class="co">#&gt;   Whittling iteration 100 </span></span>
<span><span class="co">#&gt;   Whittling iteration 200 </span></span>
<span><span class="co">#&gt;   No units can be removed - all are keystone - terminating</span></span>
<span><span class="co">#&gt; Calculating final statistics...</span></span>
<span><span class="co">#&gt; MinPatch processing complete!</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ============================================</span></span>
<span><span class="co">#&gt; Running MinPatch with min patch area ~ 18004.25 km^2 ( 20 x median PU)</span></span>
<span><span class="co">#&gt; ============================================</span></span>
<span><span class="co">#&gt; Validating inputs...</span></span>
<span><span class="co">#&gt; Initializing data structures...</span></span>
<span><span class="co">#&gt; Calculating boundary matrix using 14 cores...</span></span>
<span><span class="co">#&gt; Processing chunks in parallel...</span></span>
<span><span class="co">#&gt; Combining results...</span></span>
<span><span class="co">#&gt; Creating patch radius dictionary (optimized)...</span></span>
<span><span class="co">#&gt; Processed 100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 600 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 700 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 800 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 900 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1000 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Calculating initial patch statistics...</span></span>
<span><span class="co">#&gt; Stage 1: Removing small patches...</span></span>
<span><span class="co">#&gt; Stage 2: Adding new patches...</span></span>
<span><span class="co">#&gt;   Initial unmet targets: 26 </span></span>
<span><span class="co">#&gt;   Unmet feature IDs: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 18, 19, 20, 22, 23, 24, 25, 26, 27, 28 </span></span>
<span><span class="co">#&gt;   Iteration 1 - Unmet targets: 26 </span></span>
<span><span class="co">#&gt;     Found 1433 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00008005606 for unit 1467 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1467 </span></span>
<span><span class="co">#&gt;   Iteration 2 - Unmet targets: 21 </span></span>
<span><span class="co">#&gt;     Found 1266 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00006988945 for unit 684 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 684 </span></span>
<span><span class="co">#&gt;   Iteration 3 - Unmet targets: 11 </span></span>
<span><span class="co">#&gt;     Found 1103 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00005433364 for unit 916 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 916 </span></span>
<span><span class="co">#&gt;   Iteration 4 - Unmet targets: 8 </span></span>
<span><span class="co">#&gt;     Found 1026 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00004598478 for unit 965 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 965 </span></span>
<span><span class="co">#&gt;   Iteration 5 - Unmet targets: 3 </span></span>
<span><span class="co">#&gt;     Found 906 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.00001719904 for unit 749 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 749 </span></span>
<span><span class="co">#&gt;   All conservation targets are now met!</span></span>
<span><span class="co">#&gt; Stage 3: Removing unnecessary planning units...</span></span>
<span><span class="co">#&gt;     Edge units found: 105 </span></span>
<span><span class="co">#&gt;     Keystone units: 0 </span></span>
<span><span class="co">#&gt;     New keystone units: 3 </span></span>
<span><span class="co">#&gt;     Scoreable units: 102 </span></span>
<span><span class="co">#&gt;     Removed unit 171 at iteration 1 </span></span>
<span><span class="co">#&gt;     Edge units found: 102 </span></span>
<span><span class="co">#&gt;     Keystone units: 3 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 102 </span></span>
<span><span class="co">#&gt;     Removed unit 172 at iteration 2 </span></span>
<span><span class="co">#&gt;     Edge units found: 103 </span></span>
<span><span class="co">#&gt;     Keystone units: 3 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 103 </span></span>
<span><span class="co">#&gt;     Removed unit 173 at iteration 3 </span></span>
<span><span class="co">#&gt;     Edge units found: 104 </span></span>
<span><span class="co">#&gt;     Keystone units: 3 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 104 </span></span>
<span><span class="co">#&gt;     Removed unit 174 at iteration 4 </span></span>
<span><span class="co">#&gt;     Edge units found: 106 </span></span>
<span><span class="co">#&gt;     Keystone units: 3 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 106 </span></span>
<span><span class="co">#&gt;     Removed unit 175 at iteration 5 </span></span>
<span><span class="co">#&gt;     Removed unit 176 at iteration 6 </span></span>
<span><span class="co">#&gt;     Removed unit 177 at iteration 7 </span></span>
<span><span class="co">#&gt;     Removed unit 178 at iteration 8 </span></span>
<span><span class="co">#&gt;     Removed unit 149 at iteration 9 </span></span>
<span><span class="co">#&gt;     Removed unit 150 at iteration 10 </span></span>
<span><span class="co">#&gt;   Whittling iteration 100 </span></span>
<span><span class="co">#&gt;   Whittling iteration 200 </span></span>
<span><span class="co">#&gt;   Whittling iteration 300 </span></span>
<span><span class="co">#&gt;   Whittling iteration 400 </span></span>
<span><span class="co">#&gt;   Whittling iteration 500 </span></span>
<span><span class="co">#&gt;   No units can be removed - all are keystone - terminating</span></span>
<span><span class="co">#&gt; Calculating final statistics...</span></span>
<span><span class="co">#&gt; MinPatch processing complete!</span></span>
<span></span>
<span><span class="co"># name the outputs</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">minpatch_results</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"minpatch_"</span>, <span class="va">multipliers</span>, <span class="st">"x"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">minpatch_times</span><span class="op">)</span>   <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"minpatch_"</span>, <span class="va">multipliers</span>, <span class="st">"x"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interpreting-minpatch-outcomes">7. Interpreting MinPatch outcomes<a class="anchor" aria-label="anchor" href="#interpreting-minpatch-outcomes"></a>
</h2>
<p>In this section, we interpret how MinPatch modifies the baseline
solution. We compare resulting spatial patterns, patch structure, and
trade-offs between fragmentation and cost.</p>
<div class="section level4">
<h4 id="selected-planning-units-baseline-vs-minpatch-runs">7.1 Selected planning units (baseline vs MinPatch runs)<a class="anchor" aria-label="anchor" href="#selected-planning-units-baseline-vs-minpatch-runs"></a>
</h4>
<p>We start by showing the selected planning units for the baseline and
each MinPatch run.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot_solution_grid(</span></span>
<span><span class="co">#   results = minpatch_results,</span></span>
<span><span class="co">#   get_solution_fun = get_solution_with_solution1,</span></span>
<span><span class="co">#   subtitle_values = multipliers,</span></span>
<span><span class="co">#   title_prefix = "MinPatch: ",</span></span>
<span><span class="co">#   value_label_fun = function(x) paste0(x, "× median PU area"),</span></span>
<span><span class="co">#   include_baseline = TRUE,</span></span>
<span><span class="co">#   baseline_solution = s_base,</span></span>
<span><span class="co">#   baseline_title = "Baseline (prioritizr)",</span></span>
<span><span class="co">#   ncol = 2</span></span>
<span><span class="co"># )</span></span></code></pre></div>
<p>On the plot, we can see that the baseline solution is highly
fragmented, with many small and isolated selected planning units. As the
minimum patch size increases, these small patches are removed or merged,
leading to fewer, larger, and more spatially coherent patches.</p>
</div>
<div class="section level4">
<h4 id="group-summary-table-all-runs">7.2 Group summary table (all runs)<a class="anchor" aria-label="anchor" href="#group-summary-table-all-runs"></a>
</h4>
<p>Having examined the spatial solutions, we summarise all runs in a
single table to compare outcomes across different metrics.</p>
<table class="table table table-striped table-hover table-condensed table-responsive" style="width: auto !important; ">
<thead><tr>
<th style="text-align:left;font-weight: bold;">
scenario
</th>
<th style="text-align:left;font-weight: bold;">
Multiplier
</th>
<th style="text-align:left;font-weight: bold;">
Minimum patch size (km^2)
</th>
<th style="text-align:left;font-weight: bold;">
Selected PUs
</th>
<th style="text-align:left;font-weight: bold;">
Total area (km^2)
</th>
<th style="text-align:left;font-weight: bold;">
Total perimeter (km)
</th>
<th style="text-align:left;font-weight: bold;">
# patches
</th>
<th style="text-align:left;font-weight: bold;">
Valid patches (&gt;= min size)
</th>
<th style="text-align:left;font-weight: bold;">
Median patch size (km^2)
</th>
<th style="text-align:left;font-weight: bold;">
Total PU cost
</th>
<th style="text-align:left;font-weight: bold;">
Boundary cost
</th>
<th style="text-align:left;font-weight: bold;">
Overall cost
</th>
<th style="text-align:left;font-weight: bold;">
Runtime (s)
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Baseline
</td>
<td style="text-align:left;">
<ul><li></ul>
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
453
</td>
<td style="text-align:left;">
407796.3
</td>
<td style="text-align:left;">
33767.14
</td>
<td style="text-align:left;">
146
</td>
<td style="text-align:left;">
22
</td>
<td style="text-align:left;">
1800.43
</td>
<td style="text-align:left;">
407796.3
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
407796.3
</td>
<td style="text-align:left;">
0.2
</td>
</tr>
<tr>
<td style="text-align:left;">
MinPatch ×5
</td>
<td style="text-align:left;">
5
</td>
<td style="text-align:left;">
4501.06
</td>
<td style="text-align:left;">
456
</td>
<td style="text-align:left;">
410496.9
</td>
<td style="text-align:left;">
17458.62
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
23
</td>
<td style="text-align:left;">
5401.28
</td>
<td style="text-align:left;">
410496.9
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
410496.9
</td>
<td style="text-align:left;">
71.2
</td>
</tr>
<tr>
<td style="text-align:left;">
MinPatch ×10
</td>
<td style="text-align:left;">
10
</td>
<td style="text-align:left;">
9002.13
</td>
<td style="text-align:left;">
466
</td>
<td style="text-align:left;">
419499.1
</td>
<td style="text-align:left;">
14992.65
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
9902.34
</td>
<td style="text-align:left;">
419499.1
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
419499.1
</td>
<td style="text-align:left;">
77.8
</td>
</tr>
<tr>
<td style="text-align:left;">
MinPatch ×20
</td>
<td style="text-align:left;">
20
</td>
<td style="text-align:left;">
18004.25
</td>
<td style="text-align:left;">
491
</td>
<td style="text-align:left;">
442004.4
</td>
<td style="text-align:left;">
18895.37
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
11
</td>
<td style="text-align:left;">
22505.31
</td>
<td style="text-align:left;">
442004.4
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:left;">
442004.4
</td>
<td style="text-align:left;">
118.9
</td>
</tr>
</tbody>
</table>
<p>The baseline solution is highly fragmented (129 patches), with most
patches failing the minimum-size rule (only 21 valid). Once MinPatch is
applied, patches consolidate sharply: patch counts drop from 28 (×5) to
15 (×10) to 8 (×20), and all remaining patches are valid at every
multiplier. As the multiplier increases, patch sizes rise well beyond
the threshold, showing progressively stronger spatial consolidation into
fewer, larger patches.</p>
</div>
<div class="section level4">
<h4 id="change-maps-added-removed-retained-no-change">7.3 Change maps (Added / Removed / Retained / No change)<a class="anchor" aria-label="anchor" href="#change-maps-added-removed-retained-no-change"></a>
</h4>
<p>After comparing runs, we use <code>plot_minpatch</code> to map which
planning units were added, removed, or kept versus the baseline. The
maps show how MinPatch reshapes the solution to meet minimum patch sizes
and cut fragmentation.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create plots for each minpatch run and arrange them with patchwork</span></span>
<span><span class="va">plot_list</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span></span>
<span>  <span class="va">minpatch_results</span>,</span>
<span>  <span class="va">multipliers</span>,</span>
<span>  <span class="op">~</span> <span class="fu"><a href="../reference/plot_minpatch.html">plot_minpatch</a></span><span class="op">(</span></span>
<span>      <span class="va">.x</span>,</span>
<span>      title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Patch size x"</span>, <span class="va">.y</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="va">plot_list</span>,</span>
<span>  guides   <span class="op">=</span> <span class="st">"collect"</span>,</span>
<span>  ncol     <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/minpatch-plots-1.png" class="r-plt" alt="" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="patch-labelled-maps">7.4 Patch-labelled maps<a class="anchor" aria-label="anchor" href="#patch-labelled-maps"></a>
</h4>
<p>We use a function that labels patches in the MinPatch solutions and
flags each one as valid (meets the minimum patch-size rule) or invalid
(below the threshold; if they exist). This makes the patch definition
explicit and helps interpret the patch counts in the summary table.</p>
<p>Patch counts depend on how “connected” is defined. MinPatch uses
<strong>rook</strong> <strong>adjacency</strong>, where planning units
must share an edge to be in the same patch. By contrast, queen adjacency
also treats corner-touching (diagonal) units as connected. For ecology
and management, rook-connected patches are often more defensible because
they represent truly contiguous area, avoid corner-only links, and tend
to form more compact patch units.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">m</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu">minpatch</span><span class="fu">::</span><span class="fu"><a href="../reference/plot_patch_validity.html">plot_patch_validity</a></span><span class="op">(</span></span>
<span>    multiplier <span class="op">=</span> <span class="va">m</span>,</span>
<span>    multipliers <span class="op">=</span> <span class="va">multipliers</span>,</span>
<span>    minpatch_results <span class="op">=</span> <span class="va">minpatch_results</span>,</span>
<span>    pu_sf <span class="op">=</span> <span class="va">Seychelles_sf</span>,</span>
<span>    do_snap <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; MinPatch 5x: 23 patches | 23 valid | 0 invalid (threshold = 4501.063 km²) | snap = FALSE</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/patch-labelled-maps-1.png" class="r-plt" alt="" width="960" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; MinPatch 10x: 11 patches | 11 valid | 0 invalid (threshold = 9002.126 km²) | snap = FALSE</span></span></code></pre>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/patch-labelled-maps-2.png" class="r-plt" alt="" width="960" style="display: block; margin: auto;"></p>
<pre><code><span><span class="co">#&gt; MinPatch 20x: 11 patches | 11 valid | 0 invalid (threshold = 18004.25 km²) | snap = FALSE</span></span></code></pre>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/patch-labelled-maps-3.png" class="r-plt" alt="" width="960" style="display: block; margin: auto;"></p>
</div>
<div class="section level4">
<h4 id="individual-summaries-per-run">7.5 Individual summaries (per run)<a class="anchor" aria-label="anchor" href="#individual-summaries-per-run"></a>
</h4>
<p>Here, we show all the individual summaries for all the runs. These
provide a detailed breakdown and comparison of the metrics of each
minimum patch run with the baseline solution, as well as other
information such as feature level area comparison and feature change
summaries.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">minpatch_results</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="va">minpatch_results</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">factor_val</span> <span class="op">&lt;-</span> <span class="va">multipliers</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n\n## Scenario: MinPatch with min patch size = "</span>,</span>
<span>      <span class="va">factor_val</span>, <span class="st">" × median PU area\n\n"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># MinPatch summary (if it prints text)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"**MinPatch processing summary**\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/print_minpatch_summary.html">print_minpatch_summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_solutions.html">compare_solutions</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n**Overall solution comparison**\n\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">overall</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n**Feature-level area comparison**\n\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">features</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n**Feature change summary**\n\n"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">comparison</span><span class="op">$</span><span class="va">summary</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Scenario: MinPatch with min patch size = 5 × median PU area</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **MinPatch processing summary**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === MinPatch Processing Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Patch Statistics:</span></span>
<span><span class="co">#&gt;   Initial patches: 146 (valid: 22)</span></span>
<span><span class="co">#&gt;   Final patches: 23 (valid: 23)</span></span>
<span><span class="co">#&gt;   Area change: 2700637750.93 (0.7%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost Breakdown:</span></span>
<span><span class="co">#&gt;   Planning unit cost: 410496.94</span></span>
<span><span class="co">#&gt;   Boundary cost: 0.00</span></span>
<span><span class="co">#&gt;   Total cost: 410496.94</span></span>
<span><span class="co">#&gt;   Selected units: 456</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Feature Representation:</span></span>
<span><span class="co">#&gt;   Total features: 28</span></span>
<span><span class="co">#&gt;   Targets met: 28</span></span>
<span><span class="co">#&gt;   Targets unmet: 0</span></span>
<span><span class="co">#&gt;   Mean proportion: 0.376</span></span>
<span><span class="co">#&gt;   Total shortfall: 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === End Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Overall solution comparison**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                        Metric       Original       MinPatch     Change</span></span>
<span><span class="co">#&gt; 1     Selected Planning Units          453.0          456.0          3</span></span>
<span><span class="co">#&gt; 2                  Total Area 407796300391.2 410496938142.2 2700637751</span></span>
<span><span class="co">#&gt; 3           Number of Patches          146.0           23.0       -123</span></span>
<span><span class="co">#&gt; 4 Valid Patches (&gt;= min size)           22.0           23.0          1</span></span>
<span><span class="co">#&gt; 5           Median Patch Size   1800425167.3   5401275501.9 3600850335</span></span>
<span><span class="co">#&gt; 6          Planning Unit Cost       410496.9       410496.9          0</span></span>
<span><span class="co">#&gt; 7               Boundary Cost            0.0            0.0          0</span></span>
<span><span class="co">#&gt; 8                  Total Cost       410496.9       410496.9          0</span></span>
<span><span class="co">#&gt;   Percent_Change</span></span>
<span><span class="co">#&gt; 1      0.6622517</span></span>
<span><span class="co">#&gt; 2      0.6622517</span></span>
<span><span class="co">#&gt; 3    -84.2465753</span></span>
<span><span class="co">#&gt; 4      4.5454545</span></span>
<span><span class="co">#&gt; 5    200.0000000</span></span>
<span><span class="co">#&gt; 6      0.0000000</span></span>
<span><span class="co">#&gt; 7             NA</span></span>
<span><span class="co">#&gt; 8      0.0000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Feature-level area comparison**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Feature_ID Target Original_Area MinPatch_Area Area_Change Percent_Change</span></span>
<span><span class="co">#&gt; 1           1   11.1            12            12           0      0.0000000</span></span>
<span><span class="co">#&gt; 2           2    4.5             5             7           2     40.0000000</span></span>
<span><span class="co">#&gt; 3           3  110.1           111           112           1      0.9009009</span></span>
<span><span class="co">#&gt; 4           4  324.3           325           325           0      0.0000000</span></span>
<span><span class="co">#&gt; 5           5   86.1            93            87          -6     -6.4516129</span></span>
<span><span class="co">#&gt; 6           6   45.9            46            59          13     28.2608696</span></span>
<span><span class="co">#&gt; 7           7  163.2           175           178           3      1.7142857</span></span>
<span><span class="co">#&gt; 8           8  116.1           125           123          -2     -1.6000000</span></span>
<span><span class="co">#&gt; 9           9    0.6             1             1           0      0.0000000</span></span>
<span><span class="co">#&gt; 10         10    0.6             1             1           0      0.0000000</span></span>
<span><span class="co">#&gt; 11         11   23.1            30            28          -2     -6.6666667</span></span>
<span><span class="co">#&gt; 12         12    2.1             4             3          -1    -25.0000000</span></span>
<span><span class="co">#&gt; 13         13    3.3             5             4          -1    -20.0000000</span></span>
<span><span class="co">#&gt; 14         14  158.7           179           171          -8     -4.4692737</span></span>
<span><span class="co">#&gt; 15         15   64.5            67            80          13     19.4029851</span></span>
<span><span class="co">#&gt; 16         16   20.7            25            22          -3    -12.0000000</span></span>
<span><span class="co">#&gt; 17         17    2.1             3             3           0      0.0000000</span></span>
<span><span class="co">#&gt; 18         18   22.5            42            34          -8    -19.0476190</span></span>
<span><span class="co">#&gt; 19         19    0.6             1             1           0      0.0000000</span></span>
<span><span class="co">#&gt; 20         20   14.4            19            17          -2    -10.5263158</span></span>
<span><span class="co">#&gt; 21         21    3.9             6             6           0      0.0000000</span></span>
<span><span class="co">#&gt; 22         22   63.9            75            91          16     21.3333333</span></span>
<span><span class="co">#&gt; 23         23    6.3             7             8           1     14.2857143</span></span>
<span><span class="co">#&gt; 24         24   51.3            53            67          14     26.4150943</span></span>
<span><span class="co">#&gt; 25         25  137.7           138           139           1      0.7246377</span></span>
<span><span class="co">#&gt; 26         26  150.0           152           150          -2     -1.3157895</span></span>
<span><span class="co">#&gt; 27         27   74.4            75            75           0      0.0000000</span></span>
<span><span class="co">#&gt; 28         28   87.9            88            92           4      4.5454545</span></span>
<span><span class="co">#&gt;    Original_Target_Met MinPatch_Target_Met Original_Proportion</span></span>
<span><span class="co">#&gt; 1                 TRUE                TRUE            1.081081</span></span>
<span><span class="co">#&gt; 2                 TRUE                TRUE            1.111111</span></span>
<span><span class="co">#&gt; 3                 TRUE                TRUE            1.008174</span></span>
<span><span class="co">#&gt; 4                 TRUE                TRUE            1.002158</span></span>
<span><span class="co">#&gt; 5                 TRUE                TRUE            1.080139</span></span>
<span><span class="co">#&gt; 6                 TRUE                TRUE            1.002179</span></span>
<span><span class="co">#&gt; 7                 TRUE                TRUE            1.072304</span></span>
<span><span class="co">#&gt; 8                 TRUE                TRUE            1.076658</span></span>
<span><span class="co">#&gt; 9                 TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 10                TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 11                TRUE                TRUE            1.298701</span></span>
<span><span class="co">#&gt; 12                TRUE                TRUE            1.904762</span></span>
<span><span class="co">#&gt; 13                TRUE                TRUE            1.515152</span></span>
<span><span class="co">#&gt; 14                TRUE                TRUE            1.127914</span></span>
<span><span class="co">#&gt; 15                TRUE                TRUE            1.038760</span></span>
<span><span class="co">#&gt; 16                TRUE                TRUE            1.207729</span></span>
<span><span class="co">#&gt; 17                TRUE                TRUE            1.428571</span></span>
<span><span class="co">#&gt; 18                TRUE                TRUE            1.866667</span></span>
<span><span class="co">#&gt; 19                TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 20                TRUE                TRUE            1.319444</span></span>
<span><span class="co">#&gt; 21                TRUE                TRUE            1.538462</span></span>
<span><span class="co">#&gt; 22                TRUE                TRUE            1.173709</span></span>
<span><span class="co">#&gt; 23                TRUE                TRUE            1.111111</span></span>
<span><span class="co">#&gt; 24                TRUE                TRUE            1.033138</span></span>
<span><span class="co">#&gt; 25                TRUE                TRUE            1.002179</span></span>
<span><span class="co">#&gt; 26                TRUE                TRUE            1.013333</span></span>
<span><span class="co">#&gt; 27                TRUE                TRUE            1.008065</span></span>
<span><span class="co">#&gt; 28                TRUE                TRUE            1.001138</span></span>
<span><span class="co">#&gt;    MinPatch_Proportion</span></span>
<span><span class="co">#&gt; 1             1.081081</span></span>
<span><span class="co">#&gt; 2             1.555556</span></span>
<span><span class="co">#&gt; 3             1.017257</span></span>
<span><span class="co">#&gt; 4             1.002158</span></span>
<span><span class="co">#&gt; 5             1.010453</span></span>
<span><span class="co">#&gt; 6             1.285403</span></span>
<span><span class="co">#&gt; 7             1.090686</span></span>
<span><span class="co">#&gt; 8             1.059432</span></span>
<span><span class="co">#&gt; 9             1.666667</span></span>
<span><span class="co">#&gt; 10            1.666667</span></span>
<span><span class="co">#&gt; 11            1.212121</span></span>
<span><span class="co">#&gt; 12            1.428571</span></span>
<span><span class="co">#&gt; 13            1.212121</span></span>
<span><span class="co">#&gt; 14            1.077505</span></span>
<span><span class="co">#&gt; 15            1.240310</span></span>
<span><span class="co">#&gt; 16            1.062802</span></span>
<span><span class="co">#&gt; 17            1.428571</span></span>
<span><span class="co">#&gt; 18            1.511111</span></span>
<span><span class="co">#&gt; 19            1.666667</span></span>
<span><span class="co">#&gt; 20            1.180556</span></span>
<span><span class="co">#&gt; 21            1.538462</span></span>
<span><span class="co">#&gt; 22            1.424100</span></span>
<span><span class="co">#&gt; 23            1.269841</span></span>
<span><span class="co">#&gt; 24            1.306043</span></span>
<span><span class="co">#&gt; 25            1.009441</span></span>
<span><span class="co">#&gt; 26            1.000000</span></span>
<span><span class="co">#&gt; 27            1.008065</span></span>
<span><span class="co">#&gt; 28            1.046644</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Feature change summary**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   features_improved features_reduced features_unchanged targets_gained</span></span>
<span><span class="co">#&gt; 1                10               10                  8              0</span></span>
<span><span class="co">#&gt;   targets_lost</span></span>
<span><span class="co">#&gt; 1            0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Scenario: MinPatch with min patch size = 10 × median PU area</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **MinPatch processing summary**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === MinPatch Processing Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Patch Statistics:</span></span>
<span><span class="co">#&gt;   Initial patches: 146 (valid: 8)</span></span>
<span><span class="co">#&gt;   Final patches: 11 (valid: 11)</span></span>
<span><span class="co">#&gt;   Area change: 11702763587.39 (2.9%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost Breakdown:</span></span>
<span><span class="co">#&gt;   Planning unit cost: 419499.06</span></span>
<span><span class="co">#&gt;   Boundary cost: 0.00</span></span>
<span><span class="co">#&gt;   Total cost: 419499.06</span></span>
<span><span class="co">#&gt;   Selected units: 466</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Feature Representation:</span></span>
<span><span class="co">#&gt;   Total features: 28</span></span>
<span><span class="co">#&gt;   Targets met: 28</span></span>
<span><span class="co">#&gt;   Targets unmet: 0</span></span>
<span><span class="co">#&gt;   Mean proportion: 0.439</span></span>
<span><span class="co">#&gt;   Total shortfall: 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === End Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Overall solution comparison**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                        Metric       Original       MinPatch      Change</span></span>
<span><span class="co">#&gt; 1     Selected Planning Units          453.0          466.0          13</span></span>
<span><span class="co">#&gt; 2                  Total Area 407796300391.2 419499063978.6 11702763587</span></span>
<span><span class="co">#&gt; 3           Number of Patches          146.0           11.0        -135</span></span>
<span><span class="co">#&gt; 4 Valid Patches (&gt;= min size)            8.0           11.0           3</span></span>
<span><span class="co">#&gt; 5           Median Patch Size   1800425167.3   9902338420.1  8101913253</span></span>
<span><span class="co">#&gt; 6          Planning Unit Cost       419499.1       419499.1           0</span></span>
<span><span class="co">#&gt; 7               Boundary Cost            0.0            0.0           0</span></span>
<span><span class="co">#&gt; 8                  Total Cost       419499.1       419499.1           0</span></span>
<span><span class="co">#&gt;   Percent_Change</span></span>
<span><span class="co">#&gt; 1       2.869757</span></span>
<span><span class="co">#&gt; 2       2.869757</span></span>
<span><span class="co">#&gt; 3     -92.465753</span></span>
<span><span class="co">#&gt; 4      37.500000</span></span>
<span><span class="co">#&gt; 5     450.000000</span></span>
<span><span class="co">#&gt; 6       0.000000</span></span>
<span><span class="co">#&gt; 7             NA</span></span>
<span><span class="co">#&gt; 8       0.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Feature-level area comparison**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Feature_ID Target Original_Area MinPatch_Area Area_Change Percent_Change</span></span>
<span><span class="co">#&gt; 1           1   11.1            12            12           0      0.0000000</span></span>
<span><span class="co">#&gt; 2           2    4.5             5             6           1     20.0000000</span></span>
<span><span class="co">#&gt; 3           3  110.1           111           123          12     10.8108108</span></span>
<span><span class="co">#&gt; 4           4  324.3           325           325           0      0.0000000</span></span>
<span><span class="co">#&gt; 5           5   86.1            93            87          -6     -6.4516129</span></span>
<span><span class="co">#&gt; 6           6   45.9            46            49           3      6.5217391</span></span>
<span><span class="co">#&gt; 7           7  163.2           175           169          -6     -3.4285714</span></span>
<span><span class="co">#&gt; 8           8  116.1           125           146          21     16.8000000</span></span>
<span><span class="co">#&gt; 9           9    0.6             1             1           0      0.0000000</span></span>
<span><span class="co">#&gt; 10         10    0.6             1             2           1    100.0000000</span></span>
<span><span class="co">#&gt; 11         11   23.1            30            24          -6    -20.0000000</span></span>
<span><span class="co">#&gt; 12         12    2.1             4             5           1     25.0000000</span></span>
<span><span class="co">#&gt; 13         13    3.3             5             5           0      0.0000000</span></span>
<span><span class="co">#&gt; 14         14  158.7           179           160         -19    -10.6145251</span></span>
<span><span class="co">#&gt; 15         15   64.5            67            70           3      4.4776119</span></span>
<span><span class="co">#&gt; 16         16   20.7            25            21          -4    -16.0000000</span></span>
<span><span class="co">#&gt; 17         17    2.1             3             4           1     33.3333333</span></span>
<span><span class="co">#&gt; 18         18   22.5            42            66          24     57.1428571</span></span>
<span><span class="co">#&gt; 19         19    0.6             1             1           0      0.0000000</span></span>
<span><span class="co">#&gt; 20         20   14.4            19            23           4     21.0526316</span></span>
<span><span class="co">#&gt; 21         21    3.9             6             9           3     50.0000000</span></span>
<span><span class="co">#&gt; 22         22   63.9            75            84           9     12.0000000</span></span>
<span><span class="co">#&gt; 23         23    6.3             7            12           5     71.4285714</span></span>
<span><span class="co">#&gt; 24         24   51.3            53            62           9     16.9811321</span></span>
<span><span class="co">#&gt; 25         25  137.7           138           139           1      0.7246377</span></span>
<span><span class="co">#&gt; 26         26  150.0           152           150          -2     -1.3157895</span></span>
<span><span class="co">#&gt; 27         27   74.4            75            75           0      0.0000000</span></span>
<span><span class="co">#&gt; 28         28   87.9            88           102          14     15.9090909</span></span>
<span><span class="co">#&gt;    Original_Target_Met MinPatch_Target_Met Original_Proportion</span></span>
<span><span class="co">#&gt; 1                 TRUE                TRUE            1.081081</span></span>
<span><span class="co">#&gt; 2                 TRUE                TRUE            1.111111</span></span>
<span><span class="co">#&gt; 3                 TRUE                TRUE            1.008174</span></span>
<span><span class="co">#&gt; 4                 TRUE                TRUE            1.002158</span></span>
<span><span class="co">#&gt; 5                 TRUE                TRUE            1.080139</span></span>
<span><span class="co">#&gt; 6                 TRUE                TRUE            1.002179</span></span>
<span><span class="co">#&gt; 7                 TRUE                TRUE            1.072304</span></span>
<span><span class="co">#&gt; 8                 TRUE                TRUE            1.076658</span></span>
<span><span class="co">#&gt; 9                 TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 10                TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 11                TRUE                TRUE            1.298701</span></span>
<span><span class="co">#&gt; 12                TRUE                TRUE            1.904762</span></span>
<span><span class="co">#&gt; 13                TRUE                TRUE            1.515152</span></span>
<span><span class="co">#&gt; 14                TRUE                TRUE            1.127914</span></span>
<span><span class="co">#&gt; 15                TRUE                TRUE            1.038760</span></span>
<span><span class="co">#&gt; 16                TRUE                TRUE            1.207729</span></span>
<span><span class="co">#&gt; 17                TRUE                TRUE            1.428571</span></span>
<span><span class="co">#&gt; 18                TRUE                TRUE            1.866667</span></span>
<span><span class="co">#&gt; 19                TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 20                TRUE                TRUE            1.319444</span></span>
<span><span class="co">#&gt; 21                TRUE                TRUE            1.538462</span></span>
<span><span class="co">#&gt; 22                TRUE                TRUE            1.173709</span></span>
<span><span class="co">#&gt; 23                TRUE                TRUE            1.111111</span></span>
<span><span class="co">#&gt; 24                TRUE                TRUE            1.033138</span></span>
<span><span class="co">#&gt; 25                TRUE                TRUE            1.002179</span></span>
<span><span class="co">#&gt; 26                TRUE                TRUE            1.013333</span></span>
<span><span class="co">#&gt; 27                TRUE                TRUE            1.008065</span></span>
<span><span class="co">#&gt; 28                TRUE                TRUE            1.001138</span></span>
<span><span class="co">#&gt;    MinPatch_Proportion</span></span>
<span><span class="co">#&gt; 1             1.081081</span></span>
<span><span class="co">#&gt; 2             1.333333</span></span>
<span><span class="co">#&gt; 3             1.117166</span></span>
<span><span class="co">#&gt; 4             1.002158</span></span>
<span><span class="co">#&gt; 5             1.010453</span></span>
<span><span class="co">#&gt; 6             1.067538</span></span>
<span><span class="co">#&gt; 7             1.035539</span></span>
<span><span class="co">#&gt; 8             1.257537</span></span>
<span><span class="co">#&gt; 9             1.666667</span></span>
<span><span class="co">#&gt; 10            3.333333</span></span>
<span><span class="co">#&gt; 11            1.038961</span></span>
<span><span class="co">#&gt; 12            2.380952</span></span>
<span><span class="co">#&gt; 13            1.515152</span></span>
<span><span class="co">#&gt; 14            1.008192</span></span>
<span><span class="co">#&gt; 15            1.085271</span></span>
<span><span class="co">#&gt; 16            1.014493</span></span>
<span><span class="co">#&gt; 17            1.904762</span></span>
<span><span class="co">#&gt; 18            2.933333</span></span>
<span><span class="co">#&gt; 19            1.666667</span></span>
<span><span class="co">#&gt; 20            1.597222</span></span>
<span><span class="co">#&gt; 21            2.307692</span></span>
<span><span class="co">#&gt; 22            1.314554</span></span>
<span><span class="co">#&gt; 23            1.904762</span></span>
<span><span class="co">#&gt; 24            1.208577</span></span>
<span><span class="co">#&gt; 25            1.009441</span></span>
<span><span class="co">#&gt; 26            1.000000</span></span>
<span><span class="co">#&gt; 27            1.008065</span></span>
<span><span class="co">#&gt; 28            1.160410</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Feature change summary**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   features_improved features_reduced features_unchanged targets_gained</span></span>
<span><span class="co">#&gt; 1                16                6                  6              0</span></span>
<span><span class="co">#&gt;   targets_lost</span></span>
<span><span class="co">#&gt; 1            0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Scenario: MinPatch with min patch size = 20 × median PU area</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **MinPatch processing summary**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === MinPatch Processing Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Patch Statistics:</span></span>
<span><span class="co">#&gt;   Initial patches: 146 (valid: 3)</span></span>
<span><span class="co">#&gt;   Final patches: 11 (valid: 11)</span></span>
<span><span class="co">#&gt;   Area change: 34208078178.51 (8.4%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost Breakdown:</span></span>
<span><span class="co">#&gt;   Planning unit cost: 442004.38</span></span>
<span><span class="co">#&gt;   Boundary cost: 0.00</span></span>
<span><span class="co">#&gt;   Total cost: 442004.38</span></span>
<span><span class="co">#&gt;   Selected units: 491</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Feature Representation:</span></span>
<span><span class="co">#&gt;   Total features: 28</span></span>
<span><span class="co">#&gt;   Targets met: 28</span></span>
<span><span class="co">#&gt;   Targets unmet: 0</span></span>
<span><span class="co">#&gt;   Mean proportion: 0.465</span></span>
<span><span class="co">#&gt;   Total shortfall: 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === End Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Overall solution comparison**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                        Metric       Original       MinPatch      Change</span></span>
<span><span class="co">#&gt; 1     Selected Planning Units          453.0          491.0          38</span></span>
<span><span class="co">#&gt; 2                  Total Area 407796300391.2 442004378569.8 34208078179</span></span>
<span><span class="co">#&gt; 3           Number of Patches          146.0           11.0        -135</span></span>
<span><span class="co">#&gt; 4 Valid Patches (&gt;= min size)            3.0           11.0           8</span></span>
<span><span class="co">#&gt; 5           Median Patch Size   1800425167.3  22505314591.1 20704889424</span></span>
<span><span class="co">#&gt; 6          Planning Unit Cost       442004.4       442004.4           0</span></span>
<span><span class="co">#&gt; 7               Boundary Cost            0.0            0.0           0</span></span>
<span><span class="co">#&gt; 8                  Total Cost       442004.4       442004.4           0</span></span>
<span><span class="co">#&gt;   Percent_Change</span></span>
<span><span class="co">#&gt; 1       8.388521</span></span>
<span><span class="co">#&gt; 2       8.388521</span></span>
<span><span class="co">#&gt; 3     -92.465753</span></span>
<span><span class="co">#&gt; 4     266.666667</span></span>
<span><span class="co">#&gt; 5    1150.000000</span></span>
<span><span class="co">#&gt; 6       0.000000</span></span>
<span><span class="co">#&gt; 7             NA</span></span>
<span><span class="co">#&gt; 8       0.000000</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Feature-level area comparison**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    Feature_ID Target Original_Area MinPatch_Area Area_Change Percent_Change</span></span>
<span><span class="co">#&gt; 1           1   11.1            12            14           2      16.666667</span></span>
<span><span class="co">#&gt; 2           2    4.5             5             9           4      80.000000</span></span>
<span><span class="co">#&gt; 3           3  110.1           111           143          32      28.828829</span></span>
<span><span class="co">#&gt; 4           4  324.3           325           325           0       0.000000</span></span>
<span><span class="co">#&gt; 5           5   86.1            93            98           5       5.376344</span></span>
<span><span class="co">#&gt; 6           6   45.9            46            66          20      43.478261</span></span>
<span><span class="co">#&gt; 7           7  163.2           175           181           6       3.428571</span></span>
<span><span class="co">#&gt; 8           8  116.1           125           133           8       6.400000</span></span>
<span><span class="co">#&gt; 9           9    0.6             1             1           0       0.000000</span></span>
<span><span class="co">#&gt; 10         10    0.6             1             2           1     100.000000</span></span>
<span><span class="co">#&gt; 11         11   23.1            30            29          -1      -3.333333</span></span>
<span><span class="co">#&gt; 12         12    2.1             4             6           2      50.000000</span></span>
<span><span class="co">#&gt; 13         13    3.3             5             5           0       0.000000</span></span>
<span><span class="co">#&gt; 14         14  158.7           179           160         -19     -10.614525</span></span>
<span><span class="co">#&gt; 15         15   64.5            67            82          15      22.388060</span></span>
<span><span class="co">#&gt; 16         16   20.7            25            29           4      16.000000</span></span>
<span><span class="co">#&gt; 17         17    2.1             3             3           0       0.000000</span></span>
<span><span class="co">#&gt; 18         18   22.5            42            47           5      11.904762</span></span>
<span><span class="co">#&gt; 19         19    0.6             1             2           1     100.000000</span></span>
<span><span class="co">#&gt; 20         20   14.4            19            17          -2     -10.526316</span></span>
<span><span class="co">#&gt; 21         21    3.9             6             5          -1     -16.666667</span></span>
<span><span class="co">#&gt; 22         22   63.9            75            95          20      26.666667</span></span>
<span><span class="co">#&gt; 23         23    6.3             7            12           5      71.428571</span></span>
<span><span class="co">#&gt; 24         24   51.3            53            80          27      50.943396</span></span>
<span><span class="co">#&gt; 25         25  137.7           138           152          14      10.144928</span></span>
<span><span class="co">#&gt; 26         26  150.0           152           150          -2      -1.315789</span></span>
<span><span class="co">#&gt; 27         27   74.4            75            76           1       1.333333</span></span>
<span><span class="co">#&gt; 28         28   87.9            88           113          25      28.409091</span></span>
<span><span class="co">#&gt;    Original_Target_Met MinPatch_Target_Met Original_Proportion</span></span>
<span><span class="co">#&gt; 1                 TRUE                TRUE            1.081081</span></span>
<span><span class="co">#&gt; 2                 TRUE                TRUE            1.111111</span></span>
<span><span class="co">#&gt; 3                 TRUE                TRUE            1.008174</span></span>
<span><span class="co">#&gt; 4                 TRUE                TRUE            1.002158</span></span>
<span><span class="co">#&gt; 5                 TRUE                TRUE            1.080139</span></span>
<span><span class="co">#&gt; 6                 TRUE                TRUE            1.002179</span></span>
<span><span class="co">#&gt; 7                 TRUE                TRUE            1.072304</span></span>
<span><span class="co">#&gt; 8                 TRUE                TRUE            1.076658</span></span>
<span><span class="co">#&gt; 9                 TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 10                TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 11                TRUE                TRUE            1.298701</span></span>
<span><span class="co">#&gt; 12                TRUE                TRUE            1.904762</span></span>
<span><span class="co">#&gt; 13                TRUE                TRUE            1.515152</span></span>
<span><span class="co">#&gt; 14                TRUE                TRUE            1.127914</span></span>
<span><span class="co">#&gt; 15                TRUE                TRUE            1.038760</span></span>
<span><span class="co">#&gt; 16                TRUE                TRUE            1.207729</span></span>
<span><span class="co">#&gt; 17                TRUE                TRUE            1.428571</span></span>
<span><span class="co">#&gt; 18                TRUE                TRUE            1.866667</span></span>
<span><span class="co">#&gt; 19                TRUE                TRUE            1.666667</span></span>
<span><span class="co">#&gt; 20                TRUE                TRUE            1.319444</span></span>
<span><span class="co">#&gt; 21                TRUE                TRUE            1.538462</span></span>
<span><span class="co">#&gt; 22                TRUE                TRUE            1.173709</span></span>
<span><span class="co">#&gt; 23                TRUE                TRUE            1.111111</span></span>
<span><span class="co">#&gt; 24                TRUE                TRUE            1.033138</span></span>
<span><span class="co">#&gt; 25                TRUE                TRUE            1.002179</span></span>
<span><span class="co">#&gt; 26                TRUE                TRUE            1.013333</span></span>
<span><span class="co">#&gt; 27                TRUE                TRUE            1.008065</span></span>
<span><span class="co">#&gt; 28                TRUE                TRUE            1.001138</span></span>
<span><span class="co">#&gt;    MinPatch_Proportion</span></span>
<span><span class="co">#&gt; 1             1.261261</span></span>
<span><span class="co">#&gt; 2             2.000000</span></span>
<span><span class="co">#&gt; 3             1.298819</span></span>
<span><span class="co">#&gt; 4             1.002158</span></span>
<span><span class="co">#&gt; 5             1.138211</span></span>
<span><span class="co">#&gt; 6             1.437908</span></span>
<span><span class="co">#&gt; 7             1.109069</span></span>
<span><span class="co">#&gt; 8             1.145564</span></span>
<span><span class="co">#&gt; 9             1.666667</span></span>
<span><span class="co">#&gt; 10            3.333333</span></span>
<span><span class="co">#&gt; 11            1.255411</span></span>
<span><span class="co">#&gt; 12            2.857143</span></span>
<span><span class="co">#&gt; 13            1.515152</span></span>
<span><span class="co">#&gt; 14            1.008192</span></span>
<span><span class="co">#&gt; 15            1.271318</span></span>
<span><span class="co">#&gt; 16            1.400966</span></span>
<span><span class="co">#&gt; 17            1.428571</span></span>
<span><span class="co">#&gt; 18            2.088889</span></span>
<span><span class="co">#&gt; 19            3.333333</span></span>
<span><span class="co">#&gt; 20            1.180556</span></span>
<span><span class="co">#&gt; 21            1.282051</span></span>
<span><span class="co">#&gt; 22            1.486698</span></span>
<span><span class="co">#&gt; 23            1.904762</span></span>
<span><span class="co">#&gt; 24            1.559454</span></span>
<span><span class="co">#&gt; 25            1.103849</span></span>
<span><span class="co">#&gt; 26            1.000000</span></span>
<span><span class="co">#&gt; 27            1.021505</span></span>
<span><span class="co">#&gt; 28            1.285552</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Feature change summary**</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;   features_improved features_reduced features_unchanged targets_gained</span></span>
<span><span class="co">#&gt; 1                19                5                  4              0</span></span>
<span><span class="co">#&gt;   targets_lost</span></span>
<span><span class="co">#&gt; 1            0</span></span></code></pre></div>
<p><strong>Notes:</strong></p>
<ul>
<li><p>The calculation for valid and invalid patches should then again
be rechecked.</p></li>
<li><p>How is the planning unit cost calculated for the baseline? And
why does it differ in every summary table (i.e., table for each
multiplier)?</p></li>
<li><p>Add units to Total Area (km2 or m2?)</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="run-different-boundary-penalties">8. Run different boundary penalties<a class="anchor" aria-label="anchor" href="#run-different-boundary-penalties"></a>
</h2>
<p>The boundary penalty controls how strongly MinPatch favours spatially
compact patches during the whittling stage. At this step, MinPatch
attempts to remove planning units from the edges of patches while
maintaining conservation targets. Whether a unit can be removed depends
on the trade-off between its planning-unit cost and the change in
boundary cost that would result from its removal.</p>
<p>The boundary penalty scales this trade-off by assigning a cost to
fragmentation: higher values discourage the creation of additional patch
edges and therefore promote more compact solutions. In the Seychelles
example, we explore a small range of boundary penalties to illustrate
how sensitive the whittling process is to boundary costs under a marine
grid with relatively uniform planning-unit areas.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate reasonable parameters based on planning unit characteristics</span></span>
<span><span class="va">median_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_measures.html" class="external-link">st_area</a></span><span class="op">(</span><span class="va">Seychelles_sf</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">min_patch_size</span> <span class="op">&lt;-</span> <span class="va">median_area</span> <span class="op">*</span> <span class="fl">5</span></span>
<span><span class="va">patch_radius</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">median_area</span> <span class="op">*</span> <span class="fl">10</span><span class="op">/</span><span class="va">pi</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bp3</span> <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="va">t3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span> <span class="va">result3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_minpatch.html">run_minpatch</a></span><span class="op">(</span></span>
<span>  prioritizr_problem <span class="op">=</span> <span class="va">p_base</span>,</span>
<span>  prioritizr_solution <span class="op">=</span> <span class="va">s_base</span>,</span>
<span>  min_patch_size <span class="op">=</span> <span class="va">min_patch_size</span>,</span>
<span>  patch_radius <span class="op">=</span> <span class="va">patch_radius</span>,</span>
<span>  boundary_penalty <span class="op">=</span> <span class="va">bp3</span>,</span>
<span>  remove_small_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  whittle_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Validating inputs...</span></span>
<span><span class="co">#&gt; Initializing data structures...</span></span>
<span><span class="co">#&gt; Calculating boundary matrix using 14 cores...</span></span>
<span><span class="co">#&gt; Processing chunks in parallel...</span></span>
<span><span class="co">#&gt; Combining results...</span></span>
<span><span class="co">#&gt; Creating patch radius dictionary (optimized)...</span></span>
<span><span class="co">#&gt; Processed 100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 600 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 700 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 800 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 900 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1000 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Calculating initial patch statistics...</span></span>
<span><span class="co">#&gt; Stage 1: Removing small patches...</span></span>
<span><span class="co">#&gt; Stage 2: Adding new patches...</span></span>
<span><span class="co">#&gt;   Initial unmet targets: 22 </span></span>
<span><span class="co">#&gt;   Unmet feature IDs: 1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 16, 19, 20, 22, 23, 24, 25, 26, 27, 28 </span></span>
<span><span class="co">#&gt;   Iteration 1 - Unmet targets: 22 </span></span>
<span><span class="co">#&gt;     Found 1268 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0006018207 for unit 715 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 715 </span></span>
<span><span class="co">#&gt;   Iteration 2 - Unmet targets: 21 </span></span>
<span><span class="co">#&gt;     Found 1266 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0005272466 for unit 568 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 568 </span></span>
<span><span class="co">#&gt;   Iteration 3 - Unmet targets: 20 </span></span>
<span><span class="co">#&gt;     Found 1259 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0004467726 for unit 397 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 397 </span></span>
<span><span class="co">#&gt;   Iteration 4 - Unmet targets: 19 </span></span>
<span><span class="co">#&gt;     Found 1255 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0004979957 for unit 1293 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1293 </span></span>
<span><span class="co">#&gt;   Iteration 5 - Unmet targets: 19 </span></span>
<span><span class="co">#&gt;     Found 1251 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0005055629 for unit 1220 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1220 </span></span>
<span><span class="co">#&gt;   Iteration 10 - Unmet targets: 12 </span></span>
<span><span class="co">#&gt;   Iteration 20 - Unmet targets: 9 </span></span>
<span><span class="co">#&gt;   Iteration 30 - Unmet targets: 4 </span></span>
<span><span class="co">#&gt;   Iteration 40 - Unmet targets: 2 </span></span>
<span><span class="co">#&gt;   All conservation targets are now met!</span></span>
<span><span class="co">#&gt; Stage 3: Removing unnecessary planning units...</span></span>
<span><span class="co">#&gt;     Edge units found: 341 </span></span>
<span><span class="co">#&gt;     Keystone units: 0 </span></span>
<span><span class="co">#&gt;     New keystone units: 60 </span></span>
<span><span class="co">#&gt;     Scoreable units: 281 </span></span>
<span><span class="co">#&gt;     Removed unit 1256 at iteration 1 </span></span>
<span><span class="co">#&gt;     Edge units found: 281 </span></span>
<span><span class="co">#&gt;     Keystone units: 60 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 281 </span></span>
<span><span class="co">#&gt;     Unit 1276 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 280 </span></span>
<span><span class="co">#&gt;     Keystone units: 61 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 280 </span></span>
<span><span class="co">#&gt;     Unit 1277 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 279 </span></span>
<span><span class="co">#&gt;     Keystone units: 62 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 279 </span></span>
<span><span class="co">#&gt;     Removed unit 1292 at iteration 4 </span></span>
<span><span class="co">#&gt;     Edge units found: 280 </span></span>
<span><span class="co">#&gt;     Keystone units: 62 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 280 </span></span>
<span><span class="co">#&gt;     Removed unit 1293 at iteration 5 </span></span>
<span><span class="co">#&gt;     Removed unit 1219 at iteration 6 </span></span>
<span><span class="co">#&gt;     Removed unit 1220 at iteration 7 </span></span>
<span><span class="co">#&gt;     Removed unit 1257 at iteration 8 </span></span>
<span><span class="co">#&gt;     Removed unit 395 at iteration 9 </span></span>
<span><span class="co">#&gt;     Removed unit 1258 at iteration 10 </span></span>
<span><span class="co">#&gt;   No units can be removed - all are keystone - terminating</span></span>
<span><span class="co">#&gt; Calculating final statistics...</span></span>
<span><span class="co">#&gt; MinPatch processing complete!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"result3 runtime (sec):"</span>, <span class="va">t3</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; result3 runtime (sec): 35.249</span></span>
<span></span>
<span><span class="va">bp4</span> <span class="op">=</span> <span class="fl">0.00001</span></span>
<span><span class="va">t4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_minpatch.html">run_minpatch</a></span><span class="op">(</span></span>
<span>  prioritizr_problem <span class="op">=</span> <span class="va">p_base</span>,</span>
<span>  prioritizr_solution <span class="op">=</span> <span class="va">s_base</span>,</span>
<span>  min_patch_size <span class="op">=</span> <span class="va">min_patch_size</span>,</span>
<span>  patch_radius <span class="op">=</span> <span class="va">patch_radius</span>,</span>
<span>  boundary_penalty <span class="op">=</span> <span class="va">bp4</span>,</span>
<span>  remove_small_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  whittle_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Validating inputs...</span></span>
<span><span class="co">#&gt; Initializing data structures...</span></span>
<span><span class="co">#&gt; Calculating boundary matrix using 14 cores...</span></span>
<span><span class="co">#&gt; Processing chunks in parallel...</span></span>
<span><span class="co">#&gt; Combining results...</span></span>
<span><span class="co">#&gt; Creating patch radius dictionary (optimized)...</span></span>
<span><span class="co">#&gt; Processed 100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 600 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 700 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 800 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 900 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1000 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Calculating initial patch statistics...</span></span>
<span><span class="co">#&gt; Stage 1: Removing small patches...</span></span>
<span><span class="co">#&gt; Stage 2: Adding new patches...</span></span>
<span><span class="co">#&gt;   Initial unmet targets: 22 </span></span>
<span><span class="co">#&gt;   Unmet feature IDs: 1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 16, 19, 20, 22, 23, 24, 25, 26, 27, 28 </span></span>
<span><span class="co">#&gt;   Iteration 1 - Unmet targets: 22 </span></span>
<span><span class="co">#&gt;     Found 1268 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0006018207 for unit 715 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 715 </span></span>
<span><span class="co">#&gt;   Iteration 2 - Unmet targets: 21 </span></span>
<span><span class="co">#&gt;     Found 1266 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0005272466 for unit 568 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 568 </span></span>
<span><span class="co">#&gt;   Iteration 3 - Unmet targets: 20 </span></span>
<span><span class="co">#&gt;     Found 1259 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0004467726 for unit 397 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 397 </span></span>
<span><span class="co">#&gt;   Iteration 4 - Unmet targets: 19 </span></span>
<span><span class="co">#&gt;     Found 1255 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0004979957 for unit 1293 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1293 </span></span>
<span><span class="co">#&gt;   Iteration 5 - Unmet targets: 19 </span></span>
<span><span class="co">#&gt;     Found 1251 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0005055629 for unit 1220 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1220 </span></span>
<span><span class="co">#&gt;   Iteration 10 - Unmet targets: 12 </span></span>
<span><span class="co">#&gt;   Iteration 20 - Unmet targets: 9 </span></span>
<span><span class="co">#&gt;   Iteration 30 - Unmet targets: 4 </span></span>
<span><span class="co">#&gt;   Iteration 40 - Unmet targets: 2 </span></span>
<span><span class="co">#&gt;   All conservation targets are now met!</span></span>
<span><span class="co">#&gt; Stage 3: Removing unnecessary planning units...</span></span>
<span><span class="co">#&gt;     Edge units found: 341 </span></span>
<span><span class="co">#&gt;     Keystone units: 0 </span></span>
<span><span class="co">#&gt;     New keystone units: 60 </span></span>
<span><span class="co">#&gt;     Scoreable units: 281 </span></span>
<span><span class="co">#&gt;     Removed unit 1256 at iteration 1 </span></span>
<span><span class="co">#&gt;     Edge units found: 281 </span></span>
<span><span class="co">#&gt;     Keystone units: 60 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 281 </span></span>
<span><span class="co">#&gt;     Unit 1276 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 280 </span></span>
<span><span class="co">#&gt;     Keystone units: 61 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 280 </span></span>
<span><span class="co">#&gt;     Unit 1277 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 279 </span></span>
<span><span class="co">#&gt;     Keystone units: 62 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 279 </span></span>
<span><span class="co">#&gt;     Removed unit 1292 at iteration 4 </span></span>
<span><span class="co">#&gt;     Edge units found: 280 </span></span>
<span><span class="co">#&gt;     Keystone units: 62 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 280 </span></span>
<span><span class="co">#&gt;     Removed unit 1293 at iteration 5 </span></span>
<span><span class="co">#&gt;     Removed unit 1219 at iteration 6 </span></span>
<span><span class="co">#&gt;     Removed unit 1220 at iteration 7 </span></span>
<span><span class="co">#&gt;     Removed unit 1257 at iteration 8 </span></span>
<span><span class="co">#&gt;     Removed unit 395 at iteration 9 </span></span>
<span><span class="co">#&gt;     Removed unit 1258 at iteration 10 </span></span>
<span><span class="co">#&gt;   No units can be removed - all are keystone - terminating</span></span>
<span><span class="co">#&gt; Calculating final statistics...</span></span>
<span><span class="co">#&gt; MinPatch processing complete!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"result4 runtime (sec):"</span>, <span class="va">t4</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; result4 runtime (sec): 35.78</span></span>
<span></span>
<span><span class="va">bp5</span> <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="va">t5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_minpatch.html">run_minpatch</a></span><span class="op">(</span></span>
<span>  prioritizr_problem <span class="op">=</span> <span class="va">p_base</span>,</span>
<span>  prioritizr_solution <span class="op">=</span> <span class="va">s_base</span>,</span>
<span>  min_patch_size <span class="op">=</span> <span class="va">min_patch_size</span>,</span>
<span>  patch_radius <span class="op">=</span> <span class="va">patch_radius</span>,</span>
<span>  boundary_penalty <span class="op">=</span> <span class="va">bp5</span>, </span>
<span>  remove_small_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  whittle_patches <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; Validating inputs...</span></span>
<span><span class="co">#&gt; Initializing data structures...</span></span>
<span><span class="co">#&gt; Calculating boundary matrix using 14 cores...</span></span>
<span><span class="co">#&gt; Processing chunks in parallel...</span></span>
<span><span class="co">#&gt; Combining results...</span></span>
<span><span class="co">#&gt; Creating patch radius dictionary (optimized)...</span></span>
<span><span class="co">#&gt; Processed 100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 600 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 700 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 800 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 900 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1000 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1100 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1200 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1300 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1400 of 1500 planning units</span></span>
<span><span class="co">#&gt; Processed 1500 of 1500 planning units</span></span>
<span><span class="co">#&gt; Calculating initial patch statistics...</span></span>
<span><span class="co">#&gt; Stage 1: Removing small patches...</span></span>
<span><span class="co">#&gt; Stage 2: Adding new patches...</span></span>
<span><span class="co">#&gt;   Initial unmet targets: 22 </span></span>
<span><span class="co">#&gt;   Unmet feature IDs: 1, 3, 4, 5, 6, 7, 8, 9, 11, 12, 14, 15, 16, 19, 20, 22, 23, 24, 25, 26, 27, 28 </span></span>
<span><span class="co">#&gt;   Iteration 1 - Unmet targets: 22 </span></span>
<span><span class="co">#&gt;     Found 1268 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0006018207 for unit 715 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 715 </span></span>
<span><span class="co">#&gt;   Iteration 2 - Unmet targets: 21 </span></span>
<span><span class="co">#&gt;     Found 1266 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0005272466 for unit 568 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 568 </span></span>
<span><span class="co">#&gt;   Iteration 3 - Unmet targets: 20 </span></span>
<span><span class="co">#&gt;     Found 1259 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0004467726 for unit 397 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 397 </span></span>
<span><span class="co">#&gt;   Iteration 4 - Unmet targets: 19 </span></span>
<span><span class="co">#&gt;     Found 1255 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0004979957 for unit 1293 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1293 </span></span>
<span><span class="co">#&gt;   Iteration 5 - Unmet targets: 19 </span></span>
<span><span class="co">#&gt;     Found 1251 potential patches with scores</span></span>
<span><span class="co">#&gt;     Best score: 0.0005055629 for unit 1220 </span></span>
<span><span class="co">#&gt;     Added patch centered on unit 1220 </span></span>
<span><span class="co">#&gt;   Iteration 10 - Unmet targets: 12 </span></span>
<span><span class="co">#&gt;   Iteration 20 - Unmet targets: 9 </span></span>
<span><span class="co">#&gt;   Iteration 30 - Unmet targets: 4 </span></span>
<span><span class="co">#&gt;   Iteration 40 - Unmet targets: 2 </span></span>
<span><span class="co">#&gt;   All conservation targets are now met!</span></span>
<span><span class="co">#&gt; Stage 3: Removing unnecessary planning units...</span></span>
<span><span class="co">#&gt;     Edge units found: 341 </span></span>
<span><span class="co">#&gt;     Keystone units: 0 </span></span>
<span><span class="co">#&gt;     New keystone units: 60 </span></span>
<span><span class="co">#&gt;     Scoreable units: 281 </span></span>
<span><span class="co">#&gt;     Unit 1256 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 280 </span></span>
<span><span class="co">#&gt;     Keystone units: 61 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 280 </span></span>
<span><span class="co">#&gt;     Unit 1276 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 279 </span></span>
<span><span class="co">#&gt;     Keystone units: 62 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 279 </span></span>
<span><span class="co">#&gt;     Unit 1277 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 278 </span></span>
<span><span class="co">#&gt;     Keystone units: 63 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 278 </span></span>
<span><span class="co">#&gt;     Unit 1292 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Edge units found: 277 </span></span>
<span><span class="co">#&gt;     Keystone units: 64 </span></span>
<span><span class="co">#&gt;     New keystone units: 0 </span></span>
<span><span class="co">#&gt;     Scoreable units: 277 </span></span>
<span><span class="co">#&gt;     Unit 1311 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Unit 1357 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Unit 1389 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Unit 1390 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Unit 1361 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;     Unit 1219 cannot be removed - adding to keystone set</span></span>
<span><span class="co">#&gt;   Whittling iteration 100 </span></span>
<span><span class="co">#&gt;   Whittling iteration 200 </span></span>
<span><span class="co">#&gt;   No more edge units to consider - terminating</span></span>
<span><span class="co">#&gt; Calculating final statistics...</span></span>
<span><span class="co">#&gt; MinPatch processing complete!</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"result5 runtime (sec):"</span>, <span class="va">t5</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span><span class="co">#&gt; result5 runtime (sec): 50.855</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="interpreting-minpatch-with-boundary-penalties-outcomes">9. Interpreting MinPatch with boundary penalties outcomes<a class="anchor" aria-label="anchor" href="#interpreting-minpatch-with-boundary-penalties-outcomes"></a>
</h2>
<div class="section level3">
<h3 id="change-maps-added-removed-retained-no-change-1">9.1 Change maps (Added / Removed / Retained / No change)<a class="anchor" aria-label="anchor" href="#change-maps-added-removed-retained-no-change-1"></a>
</h3>
<p>Here, we visualise the MinPatch solutions for different boundary
penalty values.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="fu"><a href="../reference/plot_minpatch.html">plot_minpatch</a></span><span class="op">(</span><span class="va">result3</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Boundary Penalty: "</span>, <span class="va">bp3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="../reference/plot_minpatch.html">plot_minpatch</a></span><span class="op">(</span><span class="va">result4</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Boundary Penalty: "</span>, <span class="va">bp4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="../reference/plot_minpatch.html">plot_minpatch</a></span><span class="op">(</span><span class="va">result5</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Boundary Penalty: "</span>, <span class="va">bp5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      guides <span class="op">=</span> <span class="st">"collect"</span>,</span>
<span>                      ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/boundary-change-maps-1.png" class="r-plt" alt="" width="672" style="display: block; margin: auto;"></p>
<p>The resulting plots are all identical.</p>
</div>
<div class="section level3">
<h3 id="selected-planning-units-baseline-vs-minpatch-runs-1">9.2 Selected planning units (baseline vs MinPatch runs)<a class="anchor" aria-label="anchor" href="#selected-planning-units-baseline-vs-minpatch-runs-1"></a>
</h3>
<p>We then check the resulting spatial solutions, but only focusing on
the selected planning units.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="fu"><a href="../reference/plot_prioritizr.html">plot_prioritizr</a></span><span class="op">(</span><span class="va">result3</span><span class="op">$</span><span class="va">solution</span>, col <span class="op">=</span> <span class="st">"minpatch"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Boundary Penalty: "</span>, <span class="va">bp3</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="../reference/plot_prioritizr.html">plot_prioritizr</a></span><span class="op">(</span><span class="va">result4</span><span class="op">$</span><span class="va">solution</span>, col <span class="op">=</span> <span class="st">"minpatch"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Boundary Penalty: "</span>, <span class="va">bp4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      <span class="fu"><a href="../reference/plot_prioritizr.html">plot_prioritizr</a></span><span class="op">(</span><span class="va">result5</span><span class="op">$</span><span class="va">solution</span>, col <span class="op">=</span> <span class="st">"minpatch"</span>, title <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Boundary Penalty: "</span>, <span class="va">bp5</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                      guides <span class="op">=</span> <span class="st">"collect"</span>,</span>
<span>                      ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">&amp;</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="minpatch-oceandatr-Seychelles_files/figure-html/boundary-plot-1.png" class="r-plt" alt="" width="960" style="display: block; margin: auto;"></p>
<p>The resulting plots are again all identical.</p>
</div>
<div class="section level3">
<h3 id="group-summary-table-all-runs-1">9.3 Group summary table (all runs)<a class="anchor" aria-label="anchor" href="#group-summary-table-all-runs-1"></a>
</h3>
<p>We summarise and compare all the runs using a table.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># helper to grab one metric from the compare_solutions()$overall table</span></span>
<span><span class="va">get_metric</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">overall</span>, <span class="va">column</span>, <span class="va">metric</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">out</span> <span class="op">&lt;-</span> <span class="va">overall</span><span class="op">[[</span><span class="va">column</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">overall</span><span class="op">$</span><span class="va">Metric</span> <span class="op">==</span> <span class="va">metric</span><span class="op">]</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">out</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="cn">NA_real_</span> <span class="kw">else</span> <span class="va">out</span>  <span class="co"># safer: return NA if not found</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># MinPatch results for different boundary penalties</span></span>
<span><span class="va">boundary_penalties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bp3</span>, <span class="va">bp4</span>, <span class="va">bp5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">minpatch_results_bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">result3</span>,</span>
<span>  <span class="va">result4</span>,</span>
<span>  <span class="va">result5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># runtimes taken from your system.time() calls</span></span>
<span><span class="va">minpatch_runtimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">t3</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">t4</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">t5</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># baseline metrics from the first comparison (same "Original" across runs)</span></span>
<span><span class="va">overall0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_solutions.html">compare_solutions</a></span><span class="op">(</span><span class="va">minpatch_results_bp</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">overall</span></span>
<span></span>
<span><span class="va">baseline_row</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  scenario            <span class="op">=</span> <span class="st">"baseline"</span>,</span>
<span>  boundary_penalty    <span class="op">=</span> <span class="cn">NA_real_</span>,</span>
<span>  selected_pu         <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Selected Planning Units"</span><span class="op">)</span>,</span>
<span>  total_area          <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Total Area"</span><span class="op">)</span>,</span>
<span>  n_patches           <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Number of Patches"</span><span class="op">)</span>,</span>
<span>  valid_patches       <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Valid Patches (&gt;= min size)"</span><span class="op">)</span>,</span>
<span>  median_patch_size   <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Median Patch Size"</span><span class="op">)</span>,</span>
<span>  planning_unit_cost  <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Planning Unit Cost"</span><span class="op">)</span>,</span>
<span>  boundary_cost       <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Boundary Cost"</span><span class="op">)</span>,</span>
<span>  total_cost          <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall0</span>, <span class="st">"Original"</span>, <span class="st">"Total Cost"</span><span class="op">)</span>,</span>
<span>  runtime_sec         <span class="op">=</span> <span class="va">t_base</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>   <span class="co"># baseline runtime from your code</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># metrics for each MinPatch run (different boundary penalties)</span></span>
<span><span class="va">minpatch_rows</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map_dfr.html" class="external-link">pmap_dfr</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">minpatch_results_bp</span>,</span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.list.html" class="external-link">as.list</a></span><span class="op">(</span><span class="va">boundary_penalties</span><span class="op">)</span>,</span>
<span>    <span class="va">minpatch_runtimes</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">res</span>, <span class="va">bp</span>, <span class="va">rt</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">overall</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_solutions.html">compare_solutions</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span><span class="op">$</span><span class="va">overall</span></span>
<span>    </span>
<span>    <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>      scenario            <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"minpatch_bp"</span>, <span class="va">bp</span><span class="op">)</span>,</span>
<span>      boundary_penalty    <span class="op">=</span> <span class="va">bp</span>,</span>
<span>      selected_pu         <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Selected Planning Units"</span><span class="op">)</span>,</span>
<span>      total_area          <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Total Area"</span><span class="op">)</span>,</span>
<span>      n_patches           <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Number of Patches"</span><span class="op">)</span>,</span>
<span>      valid_patches       <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Valid Patches (&gt;= min size)"</span><span class="op">)</span>,</span>
<span>      median_patch_size   <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Median Patch Size"</span><span class="op">)</span>,</span>
<span>      planning_unit_cost  <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Planning Unit Cost"</span><span class="op">)</span>,</span>
<span>      boundary_cost       <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Boundary Cost"</span><span class="op">)</span>,</span>
<span>      total_cost          <span class="op">=</span> <span class="fu">get_metric</span><span class="op">(</span><span class="va">overall</span>, <span class="st">"MinPatch"</span>, <span class="st">"Total Cost"</span><span class="op">)</span>,</span>
<span>      runtime_sec         <span class="op">=</span> <span class="va">rt</span>   <span class="co"># runtime from t3/t4/t5</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># combine baseline + all MinPatch runs in one table</span></span>
<span><span class="va">solution_summary</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="va">baseline_row</span>, <span class="va">minpatch_rows</span><span class="op">)</span></span>
<span><span class="va">solution_summary</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 11</span></span></span>
<span><span class="co">#&gt;   scenario       boundary_penalty selected_pu total_area n_patches valid_patches</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> baseline               <span style="color: #BB0000;">NA</span>               453    4.08<span style="color: #949494;">e</span>11       146            22</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> minpatch_bp0            0               454    4.09<span style="color: #949494;">e</span>11        26            25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> minpatch_bp0.…          0.000<span style="text-decoration: underline;">01</span>         454    4.09<span style="color: #949494;">e</span>11        26            25</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> minpatch_bp1            1               464    4.18<span style="color: #949494;">e</span>11        24            23</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 5 more variables: median_patch_size &lt;dbl&gt;, planning_unit_cost &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   boundary_cost &lt;dbl&gt;, total_cost &lt;dbl&gt;, runtime_sec &lt;dbl&gt;</span></span></span></code></pre></div>
<p>The table shows that increasing the boundary penalty does not alter
any of the reported metrics for this example.</p>
</div>
<div class="section level3">
<h3 id="individual-summaries-per-run-1">9.4 Individual summaries (per run)<a class="anchor" aria-label="anchor" href="#individual-summaries-per-run-1"></a>
</h3>
<p>We show the individual summaries for every run in detail.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># MinPatch results for different boundary penalties</span></span>
<span><span class="va">boundary_penalties</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1e-5</span>, <span class="fl">1e-10</span><span class="op">)</span></span>
<span></span>
<span><span class="va">minpatch_results_bp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="va">result3</span>,</span>
<span>  <span class="va">result4</span>,</span>
<span>  <span class="va">result5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Runtimes taken from system.time() calls</span></span>
<span><span class="va">minpatch_runtimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="va">t3</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">t4</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span>,</span>
<span>  <span class="va">t5</span><span class="op">[[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Loop over all MinPatch results (different boundary penalties)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">minpatch_results_bp</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">result</span>      <span class="op">&lt;-</span> <span class="va">minpatch_results_bp</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span></span>
<span>  <span class="va">bp</span>          <span class="op">&lt;-</span> <span class="va">boundary_penalties</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>  <span class="va">runtime_sec</span> <span class="op">&lt;-</span> <span class="va">minpatch_runtimes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span></span>
<span>  <span class="co"># ---- Scenario header ----</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>    <span class="st">"\n\n## Scenario: MinPatch with boundary penalty = "</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">bp</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    <span class="st">"\n\n"</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">""</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Runtime ----</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">runtime_sec</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span></span>
<span>      <span class="st">"**Runtime:** "</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%.2f"</span>, <span class="va">runtime_sec</span><span class="op">)</span>,</span>
<span>      <span class="st">" seconds\n\n"</span>,</span>
<span>      sep <span class="op">=</span> <span class="st">""</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># ---- MinPatch processing summary ----</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"### MinPatch processing summary\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="../reference/print_minpatch_summary.html">print_minpatch_summary</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Compare solutions ----</span></span>
<span>  <span class="va">comparison</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_solutions.html">compare_solutions</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Overall comparison ----</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n### Overall solution comparison\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>    <span class="va">comparison</span><span class="op">$</span><span class="va">overall</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Comparison between the original and MinPatch-adjusted solutions (boundary penalty = "</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">bp</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="st">")"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Feature-level comparison ----</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n### Feature-level area comparison\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>    <span class="va">comparison</span><span class="op">$</span><span class="va">features</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Feature-level area and proportional changes after MinPatch (boundary penalty = "</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">bp</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="st">")"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># ---- Feature change summary ----</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"\n### Feature change summary\n\n"</span><span class="op">)</span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span></span>
<span>    <span class="va">comparison</span><span class="op">$</span><span class="va">summary</span>,</span>
<span>    caption <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span></span>
<span>      <span class="st">"Summary of improved, reduced, and unchanged features (boundary penalty = "</span>,</span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="va">bp</span>, scientific <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>      <span class="st">")"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Scenario: MinPatch with boundary penalty = 0e+00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Runtime:** 35.25 seconds</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### MinPatch processing summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === MinPatch Processing Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Patch Statistics:</span></span>
<span><span class="co">#&gt;   Initial patches: 146 (valid: 22)</span></span>
<span><span class="co">#&gt;   Final patches: 26 (valid: 25)</span></span>
<span><span class="co">#&gt;   Area change: 900212583.64 (0.2%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost Breakdown:</span></span>
<span><span class="co">#&gt;   Planning unit cost: 408696.51</span></span>
<span><span class="co">#&gt;   Boundary cost: 0.00</span></span>
<span><span class="co">#&gt;   Total cost: 408696.51</span></span>
<span><span class="co">#&gt;   Selected units: 454</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Feature Representation:</span></span>
<span><span class="co">#&gt;   Total features: 28</span></span>
<span><span class="co">#&gt;   Targets met: 28</span></span>
<span><span class="co">#&gt;   Targets unmet: 0</span></span>
<span><span class="co">#&gt;   Mean proportion: 0.399</span></span>
<span><span class="co">#&gt;   Total shortfall: 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === End Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Overall solution comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Feature-level area comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Feature change summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Scenario: MinPatch with boundary penalty = 1e-05</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Runtime:** 35.78 seconds</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### MinPatch processing summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === MinPatch Processing Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Patch Statistics:</span></span>
<span><span class="co">#&gt;   Initial patches: 146 (valid: 22)</span></span>
<span><span class="co">#&gt;   Final patches: 26 (valid: 25)</span></span>
<span><span class="co">#&gt;   Area change: 900212583.64 (0.2%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost Breakdown:</span></span>
<span><span class="co">#&gt;   Planning unit cost: 408696.51</span></span>
<span><span class="co">#&gt;   Boundary cost: 173.17</span></span>
<span><span class="co">#&gt;   Total cost: 408869.69</span></span>
<span><span class="co">#&gt;   Selected units: 454</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Feature Representation:</span></span>
<span><span class="co">#&gt;   Total features: 28</span></span>
<span><span class="co">#&gt;   Targets met: 28</span></span>
<span><span class="co">#&gt;   Targets unmet: 0</span></span>
<span><span class="co">#&gt;   Mean proportion: 0.399</span></span>
<span><span class="co">#&gt;   Total shortfall: 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === End Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Overall solution comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Feature-level area comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Feature change summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ## Scenario: MinPatch with boundary penalty = 1e-10</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; **Runtime:** 50.86 seconds</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### MinPatch processing summary</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === MinPatch Processing Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Patch Statistics:</span></span>
<span><span class="co">#&gt;   Initial patches: 146 (valid: 22)</span></span>
<span><span class="co">#&gt;   Final patches: 24 (valid: 23)</span></span>
<span><span class="co">#&gt;   Area change: 9902338420.10 (2.4%)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cost Breakdown:</span></span>
<span><span class="co">#&gt;   Planning unit cost: 417698.64</span></span>
<span><span class="co">#&gt;   Boundary cost: 17197209.33</span></span>
<span><span class="co">#&gt;   Total cost: 17614907.97</span></span>
<span><span class="co">#&gt;   Selected units: 464</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Feature Representation:</span></span>
<span><span class="co">#&gt;   Total features: 28</span></span>
<span><span class="co">#&gt;   Targets met: 28</span></span>
<span><span class="co">#&gt;   Targets unmet: 0</span></span>
<span><span class="co">#&gt;   Mean proportion: 0.416</span></span>
<span><span class="co">#&gt;   Total shortfall: 0.00</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; === End Summary ===</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Overall solution comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Feature-level area comparison</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ### Feature change summary</span></span></code></pre></div>
<p>Similarly, the values across the individual summaries are the
same.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason D. Everett, Anthony J. Richardson, Robert J. Smith.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
